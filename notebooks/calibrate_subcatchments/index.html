
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bindings to access the SWIFT2 libraries, from Python.">
      
      
        <meta name="author" content="Jean-Michel Perraud">
      
      
        <link rel="canonical" href="https://csiro-hydroinformatics.github.io/swift-py-doc/notebooks/calibrate_subcatchments/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Cascaded calibration of subcatchments defined by multiple gauges - swift2 - Python package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cascaded-calibration-of-subcatchments-defined-by-multiple-gauges" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="swift2 - Python package" class="md-header__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            swift2 - Python package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cascaded calibration of subcatchments defined by multiple gauges
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classes/" class="md-tabs__link">
          
  
  
    
  
  Submodules

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting_started/" class="md-tabs__link">
          
  
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tech_notes/" class="md-tabs__link">
          
  
  
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="swift2 - Python package" class="md-nav__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    swift2 - Python package
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Submodules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Submodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../const/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    const
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    doc_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameteriser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameteriser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../play_record/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    play_record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prototypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with the swift python package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrating tied meta parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_model_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble SWIFT model runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_initial_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration with initial model memory states as parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_multisite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration of a catchment using multisite multiobjective composition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reservoir_geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reservoir geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascaded calibration of subcatchments defined by multiple gauges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample code for log-likelihood calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../muskingum_multilink_calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linear Muskingum channel routing model - constrained subcatchment calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_correction_four_stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error correction models - ERRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tech_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    <span class="md-ellipsis">
      Use case
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameterisation" class="md-nav__link">
    <span class="md-ellipsis">
      Parameterisation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splitting-the-catchment-in-subcatchments" class="md-nav__link">
    <span class="md-ellipsis">
      Splitting the catchment in subcatchments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Splitting the catchment in subcatchments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-running-and-recording-streamflows" class="md-nav__link">
    <span class="md-ellipsis">
      Test running and recording streamflows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whole-of-catchment-calibration-combining-point-gauges" class="md-nav__link">
    <span class="md-ellipsis">
      Whole of catchment calibration combining point gauges
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cascaded-calibration-of-subcatchments-defined-by-multiple-gauges">Cascaded calibration of subcatchments defined by multiple gauges<a class="headerlink" href="#cascaded-calibration-of-subcatchments-defined-by-multiple-gauges" title="Permanent link">&para;</a></h1>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">pkg_versions_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">pkg_versions_info</span><span class="p">(</span><span class="s2">&quot;This document was generated from a jupyter notebook&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>This document was generated from a jupyter notebook on 2025-03-27 17:22:20.805191
    swift2 2.5.1
    uchronia 2.6.2
</code></pre></div>
<h2 id="use-case">Use case<a class="headerlink" href="#use-case" title="Permanent link">&para;</a></h2>
<p><strong>2021-01: this vignette works structurally, but is confined to overly short (and possibly difficult) data to keep runtime low</strong></p>
<p>This vignette demonstrates how one can calibrate a catchment using multiple gauging points available within this catchment. Instead of setting up a whole-of-catchment calibration definition, it makes sense, at least in a system where subareas above a gauge points do not have a behavior dependent on other catchment processes (meaning mostly, no managed reservoirs). SWIFT offers capabilities to calibrate such subcatchments sequentially, feeding the input flow of upstream and already calibrated subcatchments to other subcatchments, thus cutting down on the complexity and runtime of the overall catchment calibration. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">std</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="n">xr_ts_end</span><span class="p">,</span> <span class="n">xr_ts_start</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeParameteriser</span><span class="p">,</span> <span class="n">ObjectiveEvaluator</span><span class="p">,</span> <span class="n">Simulation</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.const</span><span class="w"> </span><span class="kn">import</span> <span class="n">CATCHMENT_FLOWRATE_VARID</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.vis</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_two_series</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<h2 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h2>
<p>The sample data that comes with the package contains a model definition for the South Esk catchment, including a short subset of the climate and flow record data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">model_id</span> <span class="o">=</span> <span class="s1">&#39;GR4J&#39;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">site_id</span> <span class="o">=</span> <span class="s1">&#39;South_Esk&#39;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_catchment_model</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">config_id</span><span class="o">=</span><span class="s1">&#39;catchment&#39;</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">swap_model</span><span class="p">(</span><span class="s1">&#39;LagAndRoute&#39;</span><span class="p">,</span> <span class="s1">&#39;channel_routing&#39;</span><span class="p">)</span>
</code></pre></div>
<p>A visual of the catchment structure (note: may not render yet through GitHub)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># import swift2.wrap.swift_wrap_generated as swg</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># dot_graph = swg.GetCatchmentDOTGraph_py(simulation)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># import graphviz</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># # Using graphviz package directly</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># graph = graphviz.Source(dot_graph)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="c1"># graph  # This will display the graph in a Jupyter Notebook</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Other possible visualisation resources:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="c1"># https://towardsdatascience.com/visualizing-networks-in-python-d70f4cbeb259</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># https://medium.com/@ludvig.hult/drawing-graphs-with-python-in-2019-bdd42bf9d5db</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># def loadSwiftV1TextDef(controlFile, dataDir):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1">#     import swift2.wrap.swift_wrap_generated as swg</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1">#     # controlFile = mkPathToPlatform(controlFile)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1">#     # dataDir = mkPathToPlatform(dataDir)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1">#     return swg.LoadVersionOneControlFile_py(controlFile, dataDir)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># ctrl_file = &#39;/home/per202/mnt/hydrofct/work/common/Staff/per202/sample_data/South_Esk/201601/SWIFT_Control.txt&#39;)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="c1"># stopifnot(file.exists(ctrl_file))</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1"># ms &lt;- loadSwiftV1TextDef(ctrl_file, &#39;dummy&#39;)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># ms &lt;- swapModel(ms, &#39;MuskingumNonLinear&#39;, &#39;channel_routing&#39;)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">se_climate</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;climate&#39;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">se_flows</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;flow&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">se_climate</span><span class="p">[</span><span class="s2">&quot;subcatchment.4.P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_14_0.png" /></p>
<p>The names of the climate series is already set to the climate input identifiers of the model simulation, so setting them as inputs is easy:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">se_climate</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subcatchment.1.E</th>
      <th>subcatchment.1.P</th>
      <th>subcatchment.10.E</th>
      <th>subcatchment.10.P</th>
      <th>subcatchment.11.E</th>
      <th>subcatchment.11.P</th>
      <th>subcatchment.12.E</th>
      <th>subcatchment.12.P</th>
      <th>subcatchment.13.E</th>
      <th>subcatchment.13.P</th>
      <th>...</th>
      <th>subcatchment.5.E</th>
      <th>subcatchment.5.P</th>
      <th>subcatchment.6.E</th>
      <th>subcatchment.6.P</th>
      <th>subcatchment.7.E</th>
      <th>subcatchment.7.P</th>
      <th>subcatchment.8.E</th>
      <th>subcatchment.8.P</th>
      <th>subcatchment.9.E</th>
      <th>subcatchment.9.P</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-11-01 00:00:00</th>
      <td>0.3918</td>
      <td>0.0</td>
      <td>0.4020</td>
      <td>0.0000</td>
      <td>0.3978</td>
      <td>0.0000</td>
      <td>0.4266</td>
      <td>0.0000</td>
      <td>0.3936</td>
      <td>0.0000</td>
      <td>...</td>
      <td>0.4325</td>
      <td>0.0</td>
      <td>0.4110</td>
      <td>0.0322</td>
      <td>0.4247</td>
      <td>0.0</td>
      <td>0.4377</td>
      <td>0.0</td>
      <td>0.4337</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-01 01:00:00</th>
      <td>0.4385</td>
      <td>0.0</td>
      <td>0.4493</td>
      <td>0.0207</td>
      <td>0.4446</td>
      <td>0.0433</td>
      <td>0.4763</td>
      <td>0.0179</td>
      <td>0.4397</td>
      <td>0.0555</td>
      <td>...</td>
      <td>0.4823</td>
      <td>0.0</td>
      <td>0.4593</td>
      <td>0.0000</td>
      <td>0.4746</td>
      <td>0.0</td>
      <td>0.4892</td>
      <td>0.0</td>
      <td>0.4841</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-01 02:00:00</th>
      <td>0.4614</td>
      <td>0.0</td>
      <td>0.4723</td>
      <td>0.0000</td>
      <td>0.4671</td>
      <td>0.0000</td>
      <td>0.5002</td>
      <td>0.0000</td>
      <td>0.4619</td>
      <td>0.0000</td>
      <td>...</td>
      <td>0.5060</td>
      <td>0.0</td>
      <td>0.4827</td>
      <td>0.0000</td>
      <td>0.4987</td>
      <td>0.0</td>
      <td>0.5143</td>
      <td>0.0</td>
      <td>0.5084</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows Ã— 84 columns</p>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">play_input</span><span class="p">(</span><span class="n">se_climate</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">simulation</span><span class="o">.</span><span class="n">set_simulation_span</span><span class="p">(</span><span class="n">xr_ts_start</span><span class="p">(</span><span class="n">se_climate</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">se_climate</span><span class="p">))</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">simulation</span><span class="o">.</span><span class="n">set_simulation_time_step</span><span class="p">(</span><span class="s1">&#39;hourly&#39;</span><span class="p">)</span>
</code></pre></div>
<p>The <code>doc_helper</code> submodule has helper functions to configure the gr4j model to such that it is fit to run on hourly data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">std</span><span class="o">.</span><span class="n">configure_hourly_gr4j</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
</code></pre></div>
<h2 id="parameterisation">Parameterisation<a class="headerlink" href="#parameterisation" title="Permanent link">&para;</a></h2>
<p>We define a function creating a realistic feasible parameter space. This is not the main object of this vignette, so we do not describe in details. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.helpers</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hlp</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_xarray_series</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">paste0</span><span class="p">,</span> <span class="n">rep</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_meta_parameteriser</span><span class="p">(</span><span class="n">simulation</span><span class="p">:</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">ref_area</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">time_span</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>  
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">time_span</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_span</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">define_gr4j_scaled_parameter</span><span class="p">(</span><span class="n">ref_area</span><span class="p">,</span> <span class="n">time_span</span><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="c1"># Let&#39;s define _S0_ and _R0_ parameters such that for each GR4J model instance, _S = S0 * x1_ and _R = R0 * x3_</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">p_states</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linear_parameteriser</span><span class="p">(</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>                      <span class="n">param_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;S0&quot;</span><span class="p">,</span><span class="s2">&quot;R0&quot;</span><span class="p">),</span> 
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>                      <span class="n">state_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;R&quot;</span><span class="p">),</span> 
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>                      <span class="n">scaling_var_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span><span class="s2">&quot;x3&quot;</span><span class="p">),</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>                      <span class="n">min_p_val</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span> 
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>                      <span class="n">max_p_val</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> 
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>                      <span class="n">value</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),</span> 
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>                      <span class="n">selector_type</span><span class="o">=</span><span class="s1">&#39;each subarea&#39;</span><span class="p">)</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="n">init_parameteriser</span> <span class="o">=</span> <span class="n">p_states</span><span class="o">.</span><span class="n">make_state_init_parameteriser</span><span class="p">()</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">concatenate_parameterisers</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">,</span> <span class="n">init_parameteriser</span><span class="p">)</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="n">hlp</span><span class="o">.</span><span class="n">lag_and_route_linear_storage_type</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>    <span class="n">hlp</span><span class="o">.</span><span class="n">set_reach_lengths_lag_n_route</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="n">lnrp</span> <span class="o">=</span> <span class="n">hlp</span><span class="o">.</span><span class="n">parameteriser_lag_and_route</span><span class="p">()</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">CompositeParameteriser</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">,</span> <span class="n">lnrp</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>    <span class="k">return</span> <span class="n">parameteriser</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">parameteriser</span> <span class="o">=</span> <span class="n">create_meta_parameteriser</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>log_x4</td>
      <td>0.305422</td>
      <td>0.000000</td>
      <td>2.380211</td>
    </tr>
    <tr>
      <th>1</th>
      <td>log_x1</td>
      <td>0.506690</td>
      <td>0.000000</td>
      <td>3.778151</td>
    </tr>
    <tr>
      <th>2</th>
      <td>log_x3</td>
      <td>0.315425</td>
      <td>0.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>asinh_x2</td>
      <td>2.637752</td>
      <td>-3.989327</td>
      <td>3.989327</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R0</td>
      <td>0.900000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>S0</td>
      <td>0.900000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>alpha</td>
      <td>1.000000</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>inverse_velocity</td>
      <td>1.000000</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now, checking that a default parameter set works structurally on the simulation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">set_parameter_value</span><span class="p">(</span><span class="s1">&#39;asinh_x2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">simulation</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
</code></pre></div>
<p>We are now ready to enter the main topic of this vignette, subsetting the catchment into subcatchments for calibration purposes.</p>
<h2 id="splitting-the-catchment-in-subcatchments">Splitting the catchment in subcatchments<a class="headerlink" href="#splitting-the-catchment-in-subcatchments" title="Permanent link">&para;</a></h2>
<p>The sample gauge data flow contains identifiers that are of course distinct from the network node identifiers. We create a map between them (note - this information used to be in the NodeLink file in swiftv1), and we use these node as splitting points to derive subcatchments</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">gauges</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span> <span class="s1">&#39;92106&#39;</span><span class="p">,</span> <span class="s1">&#39;592002&#39;</span><span class="p">,</span> <span class="s1">&#39;18311&#39;</span><span class="p">,</span> <span class="s1">&#39;93044&#39;</span><span class="p">,</span>    <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;181&#39;</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">node_ids</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">&#39;node.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">,</span>   <span class="s1">&#39;12&#39;</span><span class="p">,</span>   <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;30&#39;</span><span class="p">,</span>   <span class="s1">&#39;40&#39;</span><span class="p">,</span>   <span class="s1">&#39;43&#39;</span><span class="p">))</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">node_gauges</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">node_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gauges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gauges</span><span class="p">))])</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># names(gauges) = node_ids</span>
</code></pre></div>
<h3 id="test-running-and-recording-streamflows">Test running and recording streamflows<a class="headerlink" href="#test-running-and-recording-streamflows" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">get_variable_ids</span><span class="p">(</span><span class="n">node_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;node.7.InflowRate&#39;,
 &#39;node.7.InflowVolume&#39;,
 &#39;node.7.AdditionalInflowRate&#39;,
 &#39;node.7.OutflowRate&#39;,
 &#39;node.7.OutflowVolume&#39;]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">record_state</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="s2">&quot;.OutflowRate&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">modelled</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_all_recorded</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">modelled</span>
</code></pre></div>
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: 'â–º';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: 'â–¼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (variable_identifiers: 6, ensemble: 1, time: 480)&gt; Size: 23kB
array([[[11.80066449,  7.44947703, 18.42497666, ...,  0.28179863,
          0.27663744,  0.27165243]],

       [[11.19512081,  6.66918055, 12.49597281, ...,  0.38460207,
          0.38065825,  0.37679025]],

       [[ 6.83285487, 10.68999615, 17.44945727, ...,  2.26019515,
          2.22860765,  2.19794827]],

       [[11.86391178, 12.88237054, 11.40568098, ...,  0.13346021,
          0.13235124,  0.13125882]],

       [[19.862354  , 11.83475444,  8.23442729, ...,  3.61385335,
          3.55119926,  3.49124398]],

       [[20.9016399 , 23.51593328, 28.95913953, ...,  0.43200931,
          0.42719557,  0.42247987]]], shape=(6, 1, 480))
Coordinates:
  * ensemble              (ensemble) int64 8B 0
  * time                  (time) datetime64[ns] 4kB 2010-11-01 ... 2010-11-20...
  * variable_identifiers  (variable_identifiers) object 48B &#x27;node.12.OutflowR...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>variable_identifiers</span>: 6</li><li><span class='xr-has-index'>ensemble</span>: 1</li><li><span class='xr-has-index'>time</span>: 480</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-0358d421-adb9-4f39-ba89-173adaf921f7' class='xr-array-in' type='checkbox' checked><label for='section-0358d421-adb9-4f39-ba89-173adaf921f7' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>11.8 7.449 18.42 11.78 8.579 ... 0.4419 0.4369 0.432 0.4272 0.4225</span></div><div class='xr-array-data'><pre>array([[[11.80066449,  7.44947703, 18.42497666, ...,  0.28179863,
          0.27663744,  0.27165243]],

       [[11.19512081,  6.66918055, 12.49597281, ...,  0.38460207,
          0.38065825,  0.37679025]],

       [[ 6.83285487, 10.68999615, 17.44945727, ...,  2.26019515,
          2.22860765,  2.19794827]],

       [[11.86391178, 12.88237054, 11.40568098, ...,  0.13346021,
          0.13235124,  0.13125882]],

       [[19.862354  , 11.83475444,  8.23442729, ...,  3.61385335,
          3.55119926,  3.49124398]],

       [[20.9016399 , 23.51593328, 28.95913953, ...,  0.43200931,
          0.42719557,  0.42247987]]], shape=(6, 1, 480))</pre></div></div></li><li class='xr-section-item'><input id='section-c4c1d326-23d5-4add-8da7-a7a81d98a492' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c4c1d326-23d5-4add-8da7-a7a81d98a492' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ensemble</span></div><div class='xr-var-dims'>(ensemble)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-5e7ef644-d478-4118-9998-31622d780dec' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5e7ef644-d478-4118-9998-31622d780dec' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8eef087-996b-4898-aa14-b9d5712653f8' class='xr-var-data-in' type='checkbox'><label for='data-c8eef087-996b-4898-aa14-b9d5712653f8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-11-01 ... 2010-11-20T23:00:00</div><input id='attrs-e84ef6d5-7347-43fa-a0f5-20ed12dc8d1e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e84ef6d5-7347-43fa-a0f5-20ed12dc8d1e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3e373974-cb9d-44ed-8524-89b8b39f481f' class='xr-var-data-in' type='checkbox'><label for='data-3e373974-cb9d-44ed-8524-89b8b39f481f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-11-01T00:00:00.000000000&#x27;, &#x27;2010-11-01T01:00:00.000000000&#x27;,
       &#x27;2010-11-01T02:00:00.000000000&#x27;, ..., &#x27;2010-11-20T21:00:00.000000000&#x27;,
       &#x27;2010-11-20T22:00:00.000000000&#x27;, &#x27;2010-11-20T23:00:00.000000000&#x27;],
      shape=(480,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>variable_identifiers</span></div><div class='xr-var-dims'>(variable_identifiers)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;node.12.OutflowRate&#x27; ... &#x27;node....</div><input id='attrs-57e8121b-a981-4bea-834f-eeb589fec88a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-57e8121b-a981-4bea-834f-eeb589fec88a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c86f8d1f-107a-4720-a6eb-2b8f8b674231' class='xr-var-data-in' type='checkbox'><label for='data-c86f8d1f-107a-4720-a6eb-2b8f8b674231' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;node.12.OutflowRate&#x27;, &#x27;node.25.OutflowRate&#x27;, &#x27;node.30.OutflowRate&#x27;,
       &#x27;node.40.OutflowRate&#x27;, &#x27;node.43.OutflowRate&#x27;, &#x27;node.7.OutflowRate&#x27;],
      dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a6362164-43ce-4633-bcf3-e6d7c1da816b' class='xr-section-summary-in' type='checkbox'  ><label for='section-a6362164-43ce-4633-bcf3-e6d7c1da816b' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ensemble</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-dedd5cc4-9257-432c-8888-0b5f3835e285' class='xr-index-data-in' type='checkbox'/><label for='index-dedd5cc4-9257-432c-8888-0b5f3835e285' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0], dtype=&#x27;int64&#x27;, name=&#x27;ensemble&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-f143a7e1-7c7b-4663-aa0b-cae83cb62aa9' class='xr-index-data-in' type='checkbox'/><label for='index-f143a7e1-7c7b-4663-aa0b-cae83cb62aa9' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2010-11-01 00:00:00&#x27;, &#x27;2010-11-01 01:00:00&#x27;,
               &#x27;2010-11-01 02:00:00&#x27;, &#x27;2010-11-01 03:00:00&#x27;,
               &#x27;2010-11-01 04:00:00&#x27;, &#x27;2010-11-01 05:00:00&#x27;,
               &#x27;2010-11-01 06:00:00&#x27;, &#x27;2010-11-01 07:00:00&#x27;,
               &#x27;2010-11-01 08:00:00&#x27;, &#x27;2010-11-01 09:00:00&#x27;,
               ...
               &#x27;2010-11-20 14:00:00&#x27;, &#x27;2010-11-20 15:00:00&#x27;,
               &#x27;2010-11-20 16:00:00&#x27;, &#x27;2010-11-20 17:00:00&#x27;,
               &#x27;2010-11-20 18:00:00&#x27;, &#x27;2010-11-20 19:00:00&#x27;,
               &#x27;2010-11-20 20:00:00&#x27;, &#x27;2010-11-20 21:00:00&#x27;,
               &#x27;2010-11-20 22:00:00&#x27;, &#x27;2010-11-20 23:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=480, freq=&#x27;h&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>variable_identifiers</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-b0f9620a-b9ae-4e9c-8744-077e58374e75' class='xr-index-data-in' type='checkbox'/><label for='index-b0f9620a-b9ae-4e9c-8744-077e58374e75' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;node.12.OutflowRate&#x27;, &#x27;node.25.OutflowRate&#x27;, &#x27;node.30.OutflowRate&#x27;,
       &#x27;node.40.OutflowRate&#x27;, &#x27;node.43.OutflowRate&#x27;, &#x27;node.7.OutflowRate&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;variable_identifiers&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a9dad319-4d93-4368-8de4-3e089d90ba7c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a9dad319-4d93-4368-8de4-3e089d90ba7c' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">modelled</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">variable_identifiers</span><span class="o">=</span><span class="s1">&#39;node.7.OutflowRate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&lt;matplotlib.lines.Line2D at 0x7fe789309510&gt;]
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_33_1.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">se_flows</span><span class="p">[</span><span class="n">gauges</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;Axes: &gt;
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_34_1.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_multivariate_time_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cols_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="sd">    Plots all columns of a Pandas DataFrame (time series) in a grid using Seaborn.</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="sd">    Args:</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="sd">        df (pd.DataFrame): DataFrame with a DatetimeIndex.</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="sd">        cols_wrap (int): Number of columns in the grid.  Defaults to 3.</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="n">num_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_cols</span> <span class="o">+</span> <span class="n">cols_wrap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols_wrap</span>  <span class="c1"># Calculate number of rows needed</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">cols_wrap</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">num_rows</span><span class="p">))</span> <span class="c1"># Adjust figure size as needed</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Flatten the axes array for easy indexing</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>        <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>    <span class="c1"># Remove any unused subplots</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cols</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust layout to prevent overlapping titles/labels</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="c1"># Example usage (assuming you have a DataFrame called &#39;se_flows&#39;)</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="n">plot_multivariate_time_series</span><span class="p">(</span><span class="n">se_flows</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_35_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">split_element_ids</span> <span class="o">=</span> <span class="n">node_ids</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">sub_cats</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">split_to_subcatchments</span><span class="p">(</span><span class="n">split_element_ids</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">sub_cats</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>OrderedDict([(&#39;node.40&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;),
             (&#39;node.25&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;),
             (&#39;node.12&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;),
             (&#39;node.7&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;),
             (&#39;node.30&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;),
             (&#39;node.43&#39;,
              Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;)])
</code></pre></div>
<p>The resulting list of subcatchment simulations is already ordered in an upstream to downstream order by SWIFT.</p>
<p>If we are to set up the first step of the sequential calibration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">sub_cats</span><span class="p">[</span><span class="s1">&#39;node.40&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subareas&#39;: {&#39;37&#39;: &#39;Subarea_37&#39;, &#39;38&#39;: &#39;Subarea_38&#39;, &#39;39&#39;: &#39;Subarea_39&#39;},
 &#39;nodes&#39;: {&#39;40&#39;: &#39;Node_40&#39;, &#39;39&#39;: &#39;Node_39&#39;, &#39;38&#39;: &#39;Node_38&#39;, &#39;37&#39;: &#39;Node_37&#39;},
 &#39;links&#39;: {&#39;39&#39;: &#39;Subarea_39&#39;, &#39;38&#39;: &#39;Subarea_38&#39;, &#39;37&#39;: &#39;Subarea_37&#39;}}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">d</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">):</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">sub_cats</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>  
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">element_id</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="n">sub_cats</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">element_id</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;node.40&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">gaugeId</span> <span class="o">=</span> <span class="n">node_gauges</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">gaugeId</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>np.str_(&#39;25&#39;)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">gauge_flow</span> <span class="o">=</span> <span class="n">se_flows</span><span class="p">[[</span><span class="n">gaugeId</span><span class="p">]]</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">gauge_flow</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-11-01 00:00:00</th>
      <td>1.229</td>
    </tr>
    <tr>
      <th>2010-11-01 01:00:00</th>
      <td>1.259</td>
    </tr>
    <tr>
      <th>2010-11-01 02:00:00</th>
      <td>1.280</td>
    </tr>
    <tr>
      <th>2010-11-01 03:00:00</th>
      <td>1.291</td>
    </tr>
    <tr>
      <th>2010-11-01 04:00:00</th>
      <td>1.296</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">sc</span> <span class="o">=</span> <span class="n">sub_cats</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">sc</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">var_id</span> <span class="o">=</span> <span class="n">CATCHMENT_FLOWRATE_VARID</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">sc</span><span class="o">.</span><span class="n">record_state</span><span class="p">(</span><span class="n">var_id</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># DiagrammeR(getCatchmentDotGraph(sc))</span>
</code></pre></div>
<p>Let's view the default, uncalibrated output </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">get_simulation_span</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;start&#39;: datetime.datetime(2010, 11, 1, 0, 0),
 &#39;end&#39;: datetime.datetime(2010, 11, 20, 23, 0),
 &#39;time step&#39;: &#39;hourly&#39;}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_obs_vs_calc</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">calc</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;streamflow (m3/s)&quot;</span><span class="p">):</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>    <span class="n">plot_two_series</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">calc</span><span class="p">,</span> <span class="n">start_time</span> <span class="o">=</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">obs</span><span class="p">),</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">gauge_flow</span> <span class="o">=</span> <span class="n">as_xarray_series</span><span class="p">(</span><span class="n">gauge_flow</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">sc</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">plot_obs_vs_calc</span><span class="p">(</span><span class="n">gauge_flow</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">var_id</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_50_0.png" /></p>
<p>Now, setting up an objective (NSE) and optimiser:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">objectiveId</span> <span class="o">=</span> <span class="s1">&#39;NSE&#39;</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">objective</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">create_objective</span><span class="p">(</span><span class="n">var_id</span><span class="p">,</span> <span class="n">gauge_flow</span><span class="p">,</span> <span class="n">objectiveId</span><span class="p">,</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">se_flows</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">se_flows</span><span class="p">))</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">)</span>  
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># termination = getMarginalTermination( tolerance = 1e-04, cutoff_no_improvement = 30, max_hours = 2/60) </span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">termination</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">create_sce_termination_wila</span><span class="p">(</span><span class="s1">&#39;relative standard deviation&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;0.05&#39;</span><span class="p">,</span><span class="s1">&#39;0.0167&#39;</span><span class="p">))</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_default_sce_parameters</span><span class="p">()</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">params</span> <span class="o">=</span> <span class="n">parameteriser</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">Max</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">Min</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>8
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">npars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">Max</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">Min</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sce_parameter</span><span class="p">(</span><span class="n">npars</span><span class="p">)</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">termination_criterion</span> <span class="o">=</span> <span class="n">termination</span><span class="p">,</span> <span class="n">population_initialiser</span> <span class="o">=</span> <span class="n">parameteriser</span><span class="p">,</span><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sce_params</span><span class="p">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">calib_logger</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">set_calibration_logger</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">execute_optimisation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CPU times: user 3min 12s, sys: 113 ms, total: 3min 13s
Wall time: 30.3 s
</code></pre></div>
<p>And the resulting hydrograph follows. The NSE score is decent, but the magnitude of the peak is not well represented. We used a uniform value for the routing parameters; having a scaling based on link properties may be a line of enquiry.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">sorted_results</span> <span class="o">=</span> <span class="n">calib_results</span><span class="o">.</span><span class="n">sort_by_score</span><span class="p">(</span><span class="s1">&#39;NSE&#39;</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">d</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">d</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NSE</th>
      <th>log_x4</th>
      <th>log_x1</th>
      <th>log_x3</th>
      <th>asinh_x2</th>
      <th>R0</th>
      <th>S0</th>
      <th>alpha</th>
      <th>inverse_velocity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.888691</td>
      <td>2.035628</td>
      <td>1.486090</td>
      <td>1.225119</td>
      <td>0.701559</td>
      <td>0.298493</td>
      <td>0.965622</td>
      <td>37.718084</td>
      <td>19.212767</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.888215</td>
      <td>2.014001</td>
      <td>1.434314</td>
      <td>1.211284</td>
      <td>0.825745</td>
      <td>0.311075</td>
      <td>0.913083</td>
      <td>33.815693</td>
      <td>24.118050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.882085</td>
      <td>2.049073</td>
      <td>1.563873</td>
      <td>1.215658</td>
      <td>0.660270</td>
      <td>0.320351</td>
      <td>0.934830</td>
      <td>39.560723</td>
      <td>24.726786</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.881787</td>
      <td>2.019078</td>
      <td>1.451620</td>
      <td>1.128354</td>
      <td>0.751965</td>
      <td>0.314474</td>
      <td>0.908081</td>
      <td>43.861289</td>
      <td>24.969963</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.881515</td>
      <td>2.030478</td>
      <td>1.473141</td>
      <td>1.188788</td>
      <td>0.771365</td>
      <td>0.321442</td>
      <td>0.887965</td>
      <td>34.698517</td>
      <td>20.905070</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">d</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NSE</th>
      <th>log_x4</th>
      <th>log_x1</th>
      <th>log_x3</th>
      <th>asinh_x2</th>
      <th>R0</th>
      <th>S0</th>
      <th>alpha</th>
      <th>inverse_velocity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>165</th>
      <td>0.845689</td>
      <td>2.028324</td>
      <td>1.582868</td>
      <td>1.221594</td>
      <td>0.795570</td>
      <td>0.368405</td>
      <td>0.831138</td>
      <td>40.191087</td>
      <td>31.035859</td>
    </tr>
    <tr>
      <th>166</th>
      <td>0.845672</td>
      <td>2.025205</td>
      <td>1.593455</td>
      <td>1.036830</td>
      <td>0.603336</td>
      <td>0.359309</td>
      <td>0.814243</td>
      <td>39.263846</td>
      <td>34.006800</td>
    </tr>
    <tr>
      <th>167</th>
      <td>0.845376</td>
      <td>2.053991</td>
      <td>1.633836</td>
      <td>1.079567</td>
      <td>0.692984</td>
      <td>0.355601</td>
      <td>0.867360</td>
      <td>43.172832</td>
      <td>18.738915</td>
    </tr>
    <tr>
      <th>168</th>
      <td>0.844877</td>
      <td>2.014712</td>
      <td>1.470771</td>
      <td>1.077956</td>
      <td>0.631176</td>
      <td>0.357918</td>
      <td>0.888920</td>
      <td>27.770611</td>
      <td>23.967920</td>
    </tr>
    <tr>
      <th>169</th>
      <td>0.844075</td>
      <td>2.006066</td>
      <td>1.600531</td>
      <td>1.201941</td>
      <td>0.788367</td>
      <td>0.363589</td>
      <td>0.814611</td>
      <td>36.803100</td>
      <td>29.462903</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="o">.</span><span class="n">get_parameters_at_index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">p</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>               Name      Value       Min         Max
0            log_x4   2.035628  0.000000    2.380211
1            log_x1   1.486090  0.000000    3.778151
2            log_x3   1.225119  0.000000    3.000000
3          asinh_x2   0.701559 -3.989327    3.989327
4                R0   0.298493  0.000000    1.000000
5                S0   0.965622  0.000000    1.000000
6             alpha  37.718084  0.001000  100.000000
7  inverse_velocity  19.212767  0.001000  100.000000
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">p</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="n">sc</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="n">plot_obs_vs_calc</span><span class="p">(</span><span class="n">gauge_flow</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">var_id</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../calibrate_subcatchments_files/calibrate_subcatchments_61_0.png" /></p>
<p>We can create a subcatchment parameteriser, such that when applied to the whole of the South Esk, only the states of the subareas, links and nodes of the subcatchment are potentially affected.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">sp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">subcatchment_parameteriser</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">sp</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">simulation</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s1">&#39;subarea.&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="mi">41</span><span class="p">),</span> <span class="s1">&#39;.x2&#39;</span><span class="p">))</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="c1"># saIds = get_subarea_ids(simulation)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.34.x2&#39;: 0.0,
 &#39;subarea.35.x2&#39;: 0.0,
 &#39;subarea.36.x2&#39;: 0.0,
 &#39;subarea.37.x2&#39;: 0.5095629279636464,
 &#39;subarea.38.x2&#39;: 0.5095629279636464,
 &#39;subarea.39.x2&#39;: 0.5095629279636464,
 &#39;subarea.40.x2&#39;: 0.0}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># TODO</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="c1"># spFile = tempfile()</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="c1"># SaveParameterizer_R(sp, spFile)</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="c1"># # Following fails 2020-06, see https://jira.csiro.au/browse/WIRADA-631 </span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="c1"># # sp2 = LoadParameterizer_R(spFile)</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="c1"># if(file.exists(spFile)) { file.remove(spFile) }</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="o">.</span><span class="n">get_parameters_at_index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">p</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>log_x4</td>
      <td>2.035628</td>
      <td>0.000000</td>
      <td>2.380211</td>
    </tr>
    <tr>
      <th>1</th>
      <td>log_x1</td>
      <td>1.486090</td>
      <td>0.000000</td>
      <td>3.778151</td>
    </tr>
    <tr>
      <th>2</th>
      <td>log_x3</td>
      <td>1.225119</td>
      <td>0.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>asinh_x2</td>
      <td>0.701559</td>
      <td>-3.989327</td>
      <td>3.989327</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R0</td>
      <td>0.298493</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>S0</td>
      <td>0.965622</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>alpha</td>
      <td>37.718084</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>inverse_velocity</td>
      <td>19.212767</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># swoop(sc, p, param_name, from, to, num=10, var_id) {</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="c1">#   if(missing(from)) { from = GetParameterMinValue_R(p, param_name)}</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="c1">#   if(missing(to))   { to = GetParameterMaxValue_R(p, param_name)}</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="c1">#   oat(sc, p, param_name, from=from, to=to, num=num, var_id) </span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="c1"># }</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="c1"># testp(sim, p, ...) {</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="c1">#   q = CloneHypercubeParameterizer_R(p)</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="c1">#   execSimulation(sim)</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="c1">#   params = list(...)</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="c1">#   for(pname in names(params)) {set_parameter_value(q, pname, params[[pname]])}</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="c1">#   plot_obs_vs_calc(gaugeFlow, getRecorded(sim, var_id))</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="c1"># }</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="c1"># flows = swoop(sc, p, &#39;log_x4&#39;, var_id=var_id)</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="c1"># flows = swoop(&#39;log_x1&#39;)</span>
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="c1"># flows = swoop(&#39;Alpha&#39;)</span>
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="c1"># flows = merge(flows, gaugeFlow)</span>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="c1"># zoo::plot.zoo(flows, plot.type=&#39;single&#39;)</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="c1"># col=c(&#39;orange&#39;, &#39;black&#39;,&#39;blue&#39;,&#39;red&#39;)</span>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="c1"># f(...) {</span>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="c1"># params = list(...)</span>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="c1"># params</span>
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="c1"># set_parameter_value(p, names(params), as.numeric(params))</span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="c1"># applySysConfig(p, sc)</span>
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="c1"># execSimulation(sc)</span>
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="c1"># plot_obs_vs_calc(gaugeFlow, getRecorded(sc, var_id))</span>
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="c1"># }</span>
</code></pre></div>
<h2 id="whole-of-catchment-calibration-combining-point-gauges">Whole of catchment calibration combining point gauges<a class="headerlink" href="#whole-of-catchment-calibration-combining-point-gauges" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">gauges</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span> <span class="s1">&#39;92106&#39;</span><span class="p">,</span> <span class="s1">&#39;592002&#39;</span><span class="p">,</span> <span class="s1">&#39;18311&#39;</span><span class="p">,</span> <span class="s1">&#39;93044&#39;</span><span class="p">,</span>    <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;181&#39;</span><span class="p">)</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">node_ids</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">&#39;node.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">,</span>   <span class="s1">&#39;12&#39;</span><span class="p">,</span>   <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;30&#39;</span><span class="p">,</span>   <span class="s1">&#39;40&#39;</span><span class="p">,</span>   <span class="s1">&#39;43&#39;</span><span class="p">))</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">node_gauges</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">node_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gauges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gauges</span><span class="p">))])</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1"># names(gauges) = node_ids</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">calibNodes</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">&#39;node.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;12&quot;</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">element_id</span> <span class="o">=</span> <span class="n">first</span><span class="p">(</span><span class="n">sub_cats</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="n">element_id</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;node.40&#39;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">gaugeId</span> <span class="o">=</span> <span class="p">[</span><span class="n">node_gauges</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">calibNodes</span><span class="p">]</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">gauge_flow</span> <span class="o">=</span> <span class="n">se_flows</span><span class="p">[</span><span class="n">gaugeId</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">sc</span> <span class="o">=</span> <span class="n">sub_cats</span><span class="p">[</span><span class="n">element_id</span><span class="p">]</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="n">var_id</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="n">calibNodes</span><span class="p">,</span> <span class="s1">&#39;.OutflowRate&#39;</span><span class="p">)</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">simulation</span><span class="o">.</span><span class="n">record_state</span><span class="p">(</span><span class="n">var_id</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">objectiveId</span> <span class="o">=</span> <span class="s1">&#39;NSE&#39;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_obj_station</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>    <span class="n">obs</span> <span class="o">=</span> <span class="n">as_xarray_series</span><span class="p">(</span><span class="n">gauge_flow</span><span class="p">[[</span><span class="n">gaugeId</span><span class="p">[</span><span class="n">i</span><span class="p">]]])</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>    <span class="k">return</span> <span class="n">simulation</span><span class="o">.</span><span class="n">create_objective</span><span class="p">(</span><span class="n">var_id</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">obs</span><span class="p">,</span> <span class="n">objectiveId</span><span class="p">,</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">se_flows</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">se_flows</span><span class="p">))</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="n">objectives</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_obj_station</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="n">co</span> <span class="o">=</span> <span class="n">ObjectiveEvaluator</span><span class="o">.</span><span class="n">create_composite_objective</span><span class="p">(</span><span class="n">objectives</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">var_id</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">score</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">)</span> 
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="c1"># scoresAsDataFrame(score)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE:1.000000,NSE:1.000000&#39;: -262.1398134692315},
 &#39;sysconfig&#39;:                Name     Value       Min         Max
 0            log_x4  0.305422  0.000000    2.380211
 1            log_x1  0.506690  0.000000    3.778151
 2            log_x3  0.315425  0.000000    3.000000
 3          asinh_x2  0.000000 -3.989327    3.989327
 4                R0  0.900000  0.000000    1.000000
 5                S0  0.900000  0.000000    1.000000
 6             alpha  1.000000  0.001000  100.000000
 7  inverse_velocity  1.000000  0.001000  100.000000}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 CSIRO
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>