
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bindings to access the SWIFT2 libraries, from Python.">
      
      
        <meta name="author" content="Jean-Michel Perraud">
      
      
        <link rel="canonical" href="https://csiro-hydroinformatics.github.io/swift-py-doc/notebooks/calibrate_multisite/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Calibration of a catchment using multisite multiobjective composition - swift2 - Python package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calibration-of-a-catchment-using-multisite-multiobjective-composition" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="swift2 - Python package" class="md-header__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            swift2 - Python package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Calibration of a catchment using multisite multiobjective composition
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classes/" class="md-tabs__link">
          
  
  
    
  
  Submodules

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting_started/" class="md-tabs__link">
          
  
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tech_notes/" class="md-tabs__link">
          
  
  
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="swift2 - Python package" class="md-nav__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    swift2 - Python package
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Submodules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Submodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../const/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    const
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    doc_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameteriser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameteriser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../play_record/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    play_record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prototypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with the swift python package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrating tied meta parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_model_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble SWIFT model runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_initial_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration with initial model memory states as parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration of a catchment using multisite multiobjective composition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reservoir_geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reservoir geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_subcatchments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascaded calibration of subcatchments defined by multiple gauges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample code for log-likelihood calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../muskingum_multilink_calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linear Muskingum channel routing model - constrained subcatchment calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_correction_four_stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error correction models - ERRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tech_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-this-document" class="md-nav__link">
    <span class="md-ellipsis">
      About this document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    <span class="md-ellipsis">
      Use case
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-model-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Base model creation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameterisation" class="md-nav__link">
    <span class="md-ellipsis">
      Parameterisation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-weighting-multi-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Defining weighting multi-objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log-likelihood-multiple-objective" class="md-nav__link">
    <span class="md-ellipsis">
      log-likelihood multiple objective
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="calibration-of-a-catchment-using-multisite-multiobjective-composition">Calibration of a catchment using multisite multiobjective composition<a class="headerlink" href="#calibration-of-a-catchment-using-multisite-multiobjective-composition" title="Permanent link">&para;</a></h1>
<h2 id="about-this-document">About this document<a class="headerlink" href="#about-this-document" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">pkg_versions_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">pkg_versions_info</span><span class="p">(</span><span class="s2">&quot;This document was generated from a jupyter notebook&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>This document was generated from a jupyter notebook on 2025-03-27 17:22:17.155498
    swift2 2.5.1
    uchronia 2.6.2
</code></pre></div>
<h2 id="use-case">Use case<a class="headerlink" href="#use-case" title="Permanent link">&para;</a></h2>
<p>This vignette demonstrates how one can calibrate a catchment using multiple gauging points available within this catchment. This only covers the definition of the calibration, <strong>not the execution</strong>. The sample data in the package is a small subset of hourly data to keep things (data size, execution time) small.</p>
<p>This is a joint calibration weighing multiple objectives, possibly sourced from different modelling objects in the semi-distributed structure, thus a whole-of-catchment calibration technique. A staged, cascading calibration is supported and described in another vignette.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">mk_full_data_id</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeParameteriser</span><span class="p">,</span> <span class="n">HypercubeParameteriser</span><span class="p">,</span> <span class="n">Simulation</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># from swift2.wrap.ffi_interop import debug_msd</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">std</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="n">TIME_DIMNAME</span><span class="p">,</span> <span class="n">slice_xr_time_series</span><span class="p">,</span> <span class="n">pd_series_to_xr_series</span><span class="p">,</span> <span class="n">slice_xr_time_series</span><span class="p">,</span> <span class="n">pd_series_to_xr_series</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="n">xr_ts_start</span><span class="p">,</span> <span class="n">xr_ts_end</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<h2 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h2>
<p>The sample data that comes with the package contains a model definition for the South Esk catchment, including a short subset of the climate and flow record data.</p>
<p><img src="south_esk.png" alt="drawing" width="600"/></p>
<!-- ![](./south_esk.png)
 -->

<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">model_id</span> <span class="o">=</span> <span class="s1">&#39;GR4J&#39;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">site_id</span> <span class="o">=</span> <span class="s1">&#39;South_Esk&#39;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">se_climate</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;climate&#39;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">se_flows</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;flow&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">se_climate</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subcatchment.1.E</th>
      <th>subcatchment.1.P</th>
      <th>subcatchment.10.E</th>
      <th>subcatchment.10.P</th>
      <th>subcatchment.11.E</th>
      <th>subcatchment.11.P</th>
      <th>subcatchment.12.E</th>
      <th>subcatchment.12.P</th>
      <th>subcatchment.13.E</th>
      <th>subcatchment.13.P</th>
      <th>...</th>
      <th>subcatchment.5.E</th>
      <th>subcatchment.5.P</th>
      <th>subcatchment.6.E</th>
      <th>subcatchment.6.P</th>
      <th>subcatchment.7.E</th>
      <th>subcatchment.7.P</th>
      <th>subcatchment.8.E</th>
      <th>subcatchment.8.P</th>
      <th>subcatchment.9.E</th>
      <th>subcatchment.9.P</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-11-01 00:00:00</th>
      <td>0.3918</td>
      <td>0.0</td>
      <td>0.4020</td>
      <td>0.0000</td>
      <td>0.3978</td>
      <td>0.0000</td>
      <td>0.4266</td>
      <td>0.0000</td>
      <td>0.3936</td>
      <td>0.0000</td>
      <td>...</td>
      <td>0.4325</td>
      <td>0.0</td>
      <td>0.4110</td>
      <td>0.0322</td>
      <td>0.4247</td>
      <td>0.0</td>
      <td>0.4377</td>
      <td>0.0</td>
      <td>0.4337</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-01 01:00:00</th>
      <td>0.4385</td>
      <td>0.0</td>
      <td>0.4493</td>
      <td>0.0207</td>
      <td>0.4446</td>
      <td>0.0433</td>
      <td>0.4763</td>
      <td>0.0179</td>
      <td>0.4397</td>
      <td>0.0555</td>
      <td>...</td>
      <td>0.4823</td>
      <td>0.0</td>
      <td>0.4593</td>
      <td>0.0000</td>
      <td>0.4746</td>
      <td>0.0</td>
      <td>0.4892</td>
      <td>0.0</td>
      <td>0.4841</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-01 02:00:00</th>
      <td>0.4614</td>
      <td>0.0</td>
      <td>0.4723</td>
      <td>0.0000</td>
      <td>0.4671</td>
      <td>0.0000</td>
      <td>0.5002</td>
      <td>0.0000</td>
      <td>0.4619</td>
      <td>0.0000</td>
      <td>...</td>
      <td>0.5060</td>
      <td>0.0</td>
      <td>0.4827</td>
      <td>0.0000</td>
      <td>0.4987</td>
      <td>0.0</td>
      <td>0.5143</td>
      <td>0.0</td>
      <td>0.5084</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 84 columns</p>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">se_climate</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>subcatchment.1.E</th>
      <th>subcatchment.1.P</th>
      <th>subcatchment.10.E</th>
      <th>subcatchment.10.P</th>
      <th>subcatchment.11.E</th>
      <th>subcatchment.11.P</th>
      <th>subcatchment.12.E</th>
      <th>subcatchment.12.P</th>
      <th>subcatchment.13.E</th>
      <th>subcatchment.13.P</th>
      <th>...</th>
      <th>subcatchment.5.E</th>
      <th>subcatchment.5.P</th>
      <th>subcatchment.6.E</th>
      <th>subcatchment.6.P</th>
      <th>subcatchment.7.E</th>
      <th>subcatchment.7.P</th>
      <th>subcatchment.8.E</th>
      <th>subcatchment.8.P</th>
      <th>subcatchment.9.E</th>
      <th>subcatchment.9.P</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-11-20 21:00:00</th>
      <td>0.1832</td>
      <td>0.0</td>
      <td>0.1885</td>
      <td>0.0000</td>
      <td>0.1865</td>
      <td>0.0000</td>
      <td>0.2004</td>
      <td>0.0</td>
      <td>0.1844</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.2047</td>
      <td>0.0</td>
      <td>0.1940</td>
      <td>0.0</td>
      <td>0.1988</td>
      <td>0.0</td>
      <td>0.2035</td>
      <td>0.0</td>
      <td>0.2040</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-20 22:00:00</th>
      <td>0.2809</td>
      <td>0.0</td>
      <td>0.2877</td>
      <td>0.1014</td>
      <td>0.2849</td>
      <td>0.0289</td>
      <td>0.3054</td>
      <td>0.0</td>
      <td>0.2814</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.3104</td>
      <td>0.0</td>
      <td>0.2961</td>
      <td>0.0</td>
      <td>0.3035</td>
      <td>0.0</td>
      <td>0.3105</td>
      <td>0.0</td>
      <td>0.3098</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2010-11-20 23:00:00</th>
      <td>0.3683</td>
      <td>0.0</td>
      <td>0.3762</td>
      <td>0.2028</td>
      <td>0.3727</td>
      <td>0.0577</td>
      <td>0.3990</td>
      <td>0.0</td>
      <td>0.3678</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.4044</td>
      <td>0.0</td>
      <td>0.3872</td>
      <td>0.0</td>
      <td>0.3968</td>
      <td>0.0</td>
      <td>0.4061</td>
      <td>0.0</td>
      <td>0.4041</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 84 columns</p>
</div>

<h2 id="base-model-creation">Base model creation<a class="headerlink" href="#base-model-creation" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">sample_catchment_model</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">config_id</span><span class="o">=</span><span class="s1">&#39;catchment&#39;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c1"># simulation = swap_model(simulation, &#39;MuskingumNonLinear&#39;, &#39;channel_routing&#39;)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">swap_model</span><span class="p">(</span><span class="s1">&#39;LagAndRoute&#39;</span><span class="p">,</span> <span class="s1">&#39;channel_routing&#39;</span><span class="p">)</span>
</code></pre></div>
<p>The names of the climate series is already set to the climate input identifiers of the model simulation, so setting them as inputs is easy:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">play_input</span><span class="p">(</span><span class="n">se_climate</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">simulation</span><span class="o">.</span><span class="n">set_simulation_span</span><span class="p">(</span><span class="n">xr_ts_start</span><span class="p">(</span><span class="n">se_climate</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">se_climate</span><span class="p">))</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">simulation</span><span class="o">.</span><span class="n">set_simulation_time_step</span><span class="p">(</span><span class="s1">&#39;hourly&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Moving on to define the parameters, free or fixed. We will use (for now - may change) the package calibragem, companion to SWIFT.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">std</span><span class="o">.</span><span class="n">configure_hourly_gr4j</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
</code></pre></div>
<h2 id="parameterisation">Parameterisation<a class="headerlink" href="#parameterisation" title="Permanent link">&para;</a></h2>
<p>We define a function creating a realistic feasible parameter space. The parameteriser is relatively sophisticated, but this is not the main purpose of this vignette, so we do not describe the process about defining and creating parameterisers in gread details. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">c</span><span class="p">,</span> <span class="n">paste0</span><span class="p">,</span> <span class="n">rep</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.helpers</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hlp</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_meta_parameteriser</span><span class="p">(</span><span class="n">simulation</span><span class="p">:</span><span class="n">Simulation</span><span class="p">,</span> <span class="n">ref_area</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">time_span</span><span class="o">=</span><span class="mi">3600</span><span class="p">):</span>  
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">time_span</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_span</span><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">define_gr4j_scaled_parameter</span><span class="p">(</span><span class="n">ref_area</span><span class="p">,</span> <span class="n">time_span</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    <span class="c1"># Let&#39;s define _S0_ and _R0_ parameters such that for each GR4J model instance, _S = S0 * x1_ and _R = R0 * x3_</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="n">p_states</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linear_parameteriser</span><span class="p">(</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>                      <span class="n">param_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;S0&quot;</span><span class="p">,</span><span class="s2">&quot;R0&quot;</span><span class="p">),</span> 
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>                      <span class="n">state_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;R&quot;</span><span class="p">),</span> 
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>                      <span class="n">scaling_var_name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span><span class="s2">&quot;x3&quot;</span><span class="p">),</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>                      <span class="n">min_p_val</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),</span> 
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>                      <span class="n">max_p_val</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> 
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>                      <span class="n">value</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">),</span> 
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>                      <span class="n">selector_type</span><span class="o">=</span><span class="s1">&#39;each subarea&#39;</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>    <span class="n">init_parameteriser</span> <span class="o">=</span> <span class="n">p_states</span><span class="o">.</span><span class="n">make_state_init_parameteriser</span><span class="p">()</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">concatenate_parameterisers</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">,</span> <span class="n">init_parameteriser</span><span class="p">)</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>    <span class="n">hlp</span><span class="o">.</span><span class="n">lag_and_route_linear_storage_type</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>    <span class="n">hlp</span><span class="o">.</span><span class="n">set_reach_lengths_lag_n_route</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>    <span class="n">lnrp</span> <span class="o">=</span> <span class="n">hlp</span><span class="o">.</span><span class="n">parameteriser_lag_and_route</span><span class="p">()</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    <span class="n">parameteriser</span> <span class="o">=</span> <span class="n">CompositeParameteriser</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">,</span> <span class="n">lnrp</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>    <span class="k">return</span> <span class="n">parameteriser</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">parameteriser</span> <span class="o">=</span> <span class="n">create_meta_parameteriser</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
</code></pre></div>
<p>We have built a parameteriser for jointly parameterising:</p>
<ul>
<li>GR4J parameters in transformed spaces (<span class="arithmatex">\(log\)</span> and <span class="arithmatex">\(asinh\)</span>)</li>
<li>GR4J initial soil moisture store conditions (<span class="arithmatex">\(S_0\)</span> and <span class="arithmatex">\(R_0\)</span>)</li>
<li>A "lag and route" streamflow routing scheme in transform space.</li>
</ul>
<p>There is even more happening there, because on top of GR4J parameter transformation we scale some in proportion to catchment area and time step length. But this is besides the point of this vignette: refer for instance to the vignette about tied parameters to know more about parameter transformation and composition of parameterisers. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">parameteriser</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>               Name     Value       Min         Max
0            log_x4  0.305422  0.000000    2.380211
1            log_x1  0.506690  0.000000    3.778151
2            log_x3  0.315425  0.000000    3.000000
3          asinh_x2  2.637752 -3.989327    3.989327
4                R0  0.900000  0.000000    1.000000
5                S0  0.900000  0.000000    1.000000
6             alpha  1.000000  0.001000  100.000000
7  inverse_velocity  1.000000  0.001000  100.000000
</code></pre></div>
<p>Let us check that we can apply the parameteriser and use its methods.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">set_parameter_value</span><span class="p">(</span><span class="s1">&#39;asinh_x2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">parameteriser</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">simulation</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
</code></pre></div>
<p>We are now ready to enter the main topic of this vignette, i.e. setting up a weighted multi-objective for calibration purposes.</p>
<h2 id="defining-weighting-multi-objectives">Defining weighting multi-objectives<a class="headerlink" href="#defining-weighting-multi-objectives" title="Permanent link">&para;</a></h2>
<p>The sample gauge data flow contains gauge identifiers as column headers</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">se_flows</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>3364</th>
      <th>18311</th>
      <th>25</th>
      <th>181</th>
      <th>93044</th>
      <th>592002</th>
      <th>92020</th>
      <th>92091</th>
      <th>92106</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-11-01 00:00:00</th>
      <td>1.753</td>
      <td>0.755</td>
      <td>1.229</td>
      <td>11.705</td>
      <td>10.65</td>
      <td>0.897</td>
      <td>0.8</td>
      <td>8.51</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>2010-11-01 01:00:00</th>
      <td>1.755</td>
      <td>0.753</td>
      <td>1.259</td>
      <td>11.656</td>
      <td>10.59</td>
      <td>0.897</td>
      <td>0.8</td>
      <td>8.34</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>2010-11-01 02:00:00</th>
      <td>1.746</td>
      <td>0.743</td>
      <td>1.280</td>
      <td>11.606</td>
      <td>10.56</td>
      <td>0.897</td>
      <td>0.8</td>
      <td>8.00</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>2010-11-01 03:00:00</th>
      <td>1.748</td>
      <td>0.752</td>
      <td>1.291</td>
      <td>11.570</td>
      <td>10.44</td>
      <td>0.897</td>
      <td>0.8</td>
      <td>7.96</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>2010-11-01 04:00:00</th>
      <td>1.735</td>
      <td>0.737</td>
      <td>1.296</td>
      <td>11.528</td>
      <td>10.35</td>
      <td>0.897</td>
      <td>0.8</td>
      <td>7.96</td>
      <td>9.2</td>
    </tr>
  </tbody>
</table>
</div>

<p>The network of nodes of the simulation is arbitrarily identified with nodes '1' to '43'</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">describe</span><span class="p">()[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>dict_keys([&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;, &#39;13&#39;, &#39;14&#39;, &#39;15&#39;, &#39;16&#39;, &#39;17&#39;, &#39;18&#39;, &#39;19&#39;, &#39;20&#39;, &#39;21&#39;, &#39;22&#39;, &#39;23&#39;, &#39;24&#39;, &#39;25&#39;, &#39;26&#39;, &#39;27&#39;, &#39;28&#39;, &#39;29&#39;, &#39;30&#39;, &#39;31&#39;, &#39;32&#39;, &#39;33&#39;, &#39;34&#39;, &#39;35&#39;, &#39;36&#39;, &#39;37&#39;, &#39;38&#39;, &#39;39&#39;, &#39;40&#39;, &#39;41&#39;, &#39;42&#39;, &#39;43&#39;])
</code></pre></div>
<p>We "know" that we can associate the node identifiers 'node.{i}' with gauge identifiers (note to doc maintainers: manually extracted from legacy swiftv1 NodeLink files)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">gauges</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span> <span class="s1">&#39;92106&#39;</span><span class="p">,</span> <span class="s1">&#39;592002&#39;</span><span class="p">,</span> <span class="s1">&#39;18311&#39;</span><span class="p">,</span> <span class="s1">&#39;93044&#39;</span><span class="p">,</span>    <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;181&#39;</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">node_ids</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">&#39;node.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">,</span>   <span class="s1">&#39;12&#39;</span><span class="p">,</span>   <span class="s1">&#39;25&#39;</span><span class="p">,</span>   <span class="s1">&#39;30&#39;</span><span class="p">,</span>   <span class="s1">&#39;40&#39;</span><span class="p">,</span>   <span class="s1">&#39;43&#39;</span><span class="p">))</span>   
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c1"># names(gauges) = node_ids</span>
</code></pre></div>
<p>First, let us try the Nash Sutcliffe efficiency, for simplicity (no additional parameters needed). We will set up NSE calculations at two points (nodes) in the catchments. Any model state from a link, node or subarea could be a point for statistics calculation.</p>
<p>The function <code>multi_statistic_definition</code> in the module <code>swift2.statistics</code> is used to create multisite multiobjective definitions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.statistics</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ssf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">ssf</span><span class="o">.</span><span class="n">multi_statistic_definition</span><span class="err">?</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">span</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_simulation_span</span><span class="p">()</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">span</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;start&#39;: datetime.datetime(2010, 11, 1, 0, 0),
 &#39;end&#39;: datetime.datetime(2010, 11, 20, 23, 0),
 &#39;time step&#39;: &#39;hourly&#39;}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">s</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">e</span> <span class="o">=</span> <span class="n">span</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">calibration_points</span> <span class="o">=</span> <span class="n">node_ids</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">mvids</span> <span class="o">=</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="n">calibration_points</span><span class="p">,</span> <span class="s1">&#39;OutflowRate&#39;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">mvids</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;node.7.OutflowRate&#39;, &#39;node.12.OutflowRate&#39;]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">statspec</span> <span class="o">=</span> <span class="n">ssf</span><span class="o">.</span><span class="n">multi_statistic_definition</span><span class="p">(</span> 
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>  <span class="n">model_var_ids</span> <span class="o">=</span> <span class="n">mvids</span><span class="p">,</span> 
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>  <span class="n">statistic_ids</span> <span class="o">=</span> <span class="n">rep</span><span class="p">(</span><span class="s1">&#39;nse&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>  <span class="n">objective_ids</span> <span class="o">=</span> <span class="n">calibration_points</span><span class="p">,</span> 
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>  <span class="n">objective_names</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;NSE-&quot;</span><span class="p">,</span> <span class="n">calibration_points</span><span class="p">),</span> 
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>  <span class="n">starts</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>  <span class="n">ends</span> <span class="o">=</span>  <span class="p">[</span><span class="n">e</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">hours</span><span class="o">=-</span><span class="mi">4</span><span class="p">),</span> <span class="n">e</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">hours</span><span class="o">=-</span><span class="mi">2</span><span class="p">)])</span>
</code></pre></div>
<p>We now have our set of statistics defined:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">statspec</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ModelVarId</th>
      <th>StatisticId</th>
      <th>ObjectiveId</th>
      <th>ObjectiveName</th>
      <th>Start</th>
      <th>End</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>node.7.OutflowRate</td>
      <td>nse</td>
      <td>node.7</td>
      <td>NSE-node.7</td>
      <td>2010-11-01 00:00:00</td>
      <td>2010-11-20 19:00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>node.12.OutflowRate</td>
      <td>nse</td>
      <td>node.12</td>
      <td>NSE-node.12</td>
      <td>2010-11-01 03:00:00</td>
      <td>2010-11-20 21:00:00</td>
    </tr>
  </tbody>
</table>
</div>

<p>To create a multisite objective evaluator we need to use the <code>create_multisite_objective</code> method of the <code>simulation</code> object. We have out statistics defined. The method requires observations and weights to give to combine statistics to a single objective.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">simulation</span><span class="o">.</span><span class="n">create_multisite_objective</span><span class="err">?</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">observations</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>  <span class="n">se_flows</span><span class="p">[</span><span class="n">gauges</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>  <span class="n">se_flows</span><span class="p">[</span><span class="n">gauges</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">w</span> <span class="o">=</span> <span class="p">{</span><span class="n">calibration_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">calibration_points</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mf">2.0</span><span class="p">}</span> <span class="c1"># weights (internally normalised to a total of 1.0)</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">w</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;node.7&#39;: 1.0, &#39;node.12&#39;: 2.0}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">moe</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">create_multisite_objective</span><span class="p">(</span><span class="n">statspec</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">moe</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;MultisiteObjectives&#39;: 290.33738106858823},
 &#39;sysconfig&#39;:                Name     Value       Min         Max
 0            log_x4  0.305422  0.000000    2.380211
 1            log_x1  0.506690  0.000000    3.778151
 2            log_x3  0.315425  0.000000    3.000000
 3          asinh_x2  0.000000 -3.989327    3.989327
 4                R0  0.900000  0.000000    1.000000
 5                S0  0.900000  0.000000    1.000000
 6             alpha  1.000000  0.001000  100.000000
 7  inverse_velocity  1.000000  0.001000  100.000000}
</code></pre></div>
<p>We can get the value of each objective. The two NSE scores below are negative. Note above that the composite objective is positive, i.e. the opposite of the weighted average. This is because the composite objective is always minimisable (as of writing anyway this is a design choice.)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">moe</span><span class="o">.</span><span class="n">get_scores</span><span class="p">(</span><span class="n">parameteriser</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;node.12&#39;: np.float64(-347.3329926657439),
 &#39;node.7&#39;: np.float64(-176.3461578742768)}
</code></pre></div>
<h2 id="log-likelihood-multiple-objective">log-likelihood multiple objective<a class="headerlink" href="#log-likelihood-multiple-objective" title="Permanent link">&para;</a></h2>
<p>Now, let's move on to use log-likelihood instead of NSE. This adds one level of complexity compared to the above. Besides calibrating the hydrologic parameters of GR4J and flow routing, with the Log-Likelihood we introduce a set of parameters <span class="arithmatex">\((a, b, m, s, ...)\)</span> for each calibration point. The statistic definition is similar and still straightforward</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">statspec</span> <span class="o">=</span> <span class="n">ssf</span><span class="o">.</span><span class="n">multi_statistic_definition</span><span class="p">(</span>  
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>  <span class="n">model_var_ids</span> <span class="o">=</span> <span class="n">mvids</span><span class="p">,</span> 
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>  <span class="n">statistic_ids</span> <span class="o">=</span> <span class="n">rep</span><span class="p">(</span><span class="s1">&#39;log-likelihood&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>  <span class="n">objective_ids</span><span class="o">=</span><span class="n">calibration_points</span><span class="p">,</span> 
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>  <span class="n">objective_names</span> <span class="o">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;LL-&quot;</span><span class="p">,</span> <span class="n">calibration_points</span><span class="p">),</span> 
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>  <span class="n">starts</span> <span class="o">=</span> <span class="n">rep</span><span class="p">(</span><span class="n">span</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> 
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>  <span class="n">ends</span> <span class="o">=</span> <span class="n">rep</span><span class="p">(</span><span class="n">span</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="n">statspec</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ModelVarId</th>
      <th>StatisticId</th>
      <th>ObjectiveId</th>
      <th>ObjectiveName</th>
      <th>Start</th>
      <th>End</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>node.7.OutflowRate</td>
      <td>log-likelihood</td>
      <td>node.7</td>
      <td>LL-node.7</td>
      <td>2010-11-01</td>
      <td>2010-11-20 23:00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>node.12.OutflowRate</td>
      <td>log-likelihood</td>
      <td>node.12</td>
      <td>LL-node.12</td>
      <td>2010-11-01</td>
      <td>2010-11-20 23:00:00</td>
    </tr>
  </tbody>
</table>
</div>

<p>But while we can create the calculator, we cannot evaluate it against the sole hydrologic parameters defined in the previous section</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">obj</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">create_multisite_objective</span><span class="p">(</span><span class="n">statspec</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c1">### This cannot work if the statistic is the log-likelihood:</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="c1"># obj.get_scores(fp)</span>
</code></pre></div>
<p>If we try to do the above we would end up with an error message 'Mandatory key expected in the dictionary but not found: b'</p>
<p>For this to work we need to include parameters </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">maxobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># NOTE: np.nan??</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">censor_threshold</span> <span class="o">=</span> <span class="mf">0.01</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">censopt</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="n">calc_m_and_s</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># i.e. TRUE</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="c1">#       const string LogLikelihoodKeys::KeyAugmentSimulation = &quot;augment_simulation&quot;;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="c1">#       const string LogLikelihoodKeys::KeyExcludeAtTMinusOne = &quot;exclude_t_min_one&quot;;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="c1">#       const string LogLikelihoodKeys::KeyCalculateModelledMAndS = &quot;calc_mod_m_s&quot;;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="c1">#       const string LogLikelihoodKeys::KeyMParMod = &quot;m_par_mod&quot;;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="c1">#       const string LogLikelihoodKeys::KeySParMod = &quot;s_par_mod&quot;;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">create_parameteriser</span><span class="p">(</span><span class="s1">&#39;no apply&#39;</span><span class="p">)</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="c1"># Note: exampleParameterizer is also available</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="n">p</span><span class="o">.</span><span class="n">add_to_hypercube</span><span class="p">(</span> 
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>          <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;maxobs&#39;</span><span class="p">,</span><span class="s1">&#39;ct&#39;</span><span class="p">,</span> <span class="s1">&#39;censopt&#39;</span><span class="p">,</span> <span class="s1">&#39;calc_mod_m_s&#39;</span><span class="p">),</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>          <span class="n">Min</span>   <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">maxobs</span><span class="p">,</span> <span class="n">censor_threshold</span><span class="p">,</span> <span class="n">censopt</span><span class="p">,</span> <span class="n">calc_m_and_s</span><span class="p">),</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>          <span class="n">Max</span>   <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxobs</span><span class="p">,</span> <span class="n">censor_threshold</span><span class="p">,</span> <span class="n">censopt</span><span class="p">,</span> <span class="n">calc_m_and_s</span><span class="p">),</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>          <span class="n">Value</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">maxobs</span><span class="p">,</span> <span class="n">censor_threshold</span><span class="p">,</span> <span class="n">censopt</span><span class="p">,</span> <span class="n">calc_m_and_s</span><span class="p">))</span> <span class="p">))</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="n">p</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>b</td>
      <td>-7.00</td>
      <td>-30.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>m</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>s</td>
      <td>100.00</td>
      <td>1.00</td>
      <td>1000.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a</td>
      <td>-10.00</td>
      <td>-30.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>maxobs</td>
      <td>22.00</td>
      <td>22.00</td>
      <td>22.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ct</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>6</th>
      <td>censopt</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>calc_mod_m_s</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">func_parameterisers</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">clone</span><span class="p">()]</span> <span class="c1"># for the two calib points, NSE has no param here</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">catchment_pzer</span> <span class="o">=</span> <span class="n">parameteriser</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">fp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">create_multisite_obj_parameteriser</span><span class="p">(</span><span class="n">func_parameterisers</span><span class="p">,</span> <span class="n">calibration_points</span><span class="p">,</span> <span class="n">prefixes</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="n">calibration_points</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="n">mix_func_parameteriser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hydro_parameteriser</span><span class="o">=</span><span class="n">catchment_pzer</span><span class="p">)</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">fp</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>log_x4</td>
      <td>0.305422</td>
      <td>0.000000</td>
      <td>2.380211</td>
    </tr>
    <tr>
      <th>1</th>
      <td>log_x1</td>
      <td>0.506690</td>
      <td>0.000000</td>
      <td>3.778151</td>
    </tr>
    <tr>
      <th>2</th>
      <td>log_x3</td>
      <td>0.315425</td>
      <td>0.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>asinh_x2</td>
      <td>0.000000</td>
      <td>-3.989327</td>
      <td>3.989327</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R0</td>
      <td>0.900000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>S0</td>
      <td>0.900000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>alpha</td>
      <td>1.000000</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>inverse_velocity</td>
      <td>1.000000</td>
      <td>0.001000</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>node.7.b</td>
      <td>-7.000000</td>
      <td>-30.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>node.7.m</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>node.7.s</td>
      <td>100.000000</td>
      <td>1.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>node.7.a</td>
      <td>-10.000000</td>
      <td>-30.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>node.7.maxobs</td>
      <td>22.000000</td>
      <td>22.000000</td>
      <td>22.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>node.7.ct</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>node.7.censopt</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>node.7.calc_mod_m_s</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>node.12.b</td>
      <td>-7.000000</td>
      <td>-30.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>node.12.m</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>node.12.s</td>
      <td>100.000000</td>
      <td>1.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>node.12.a</td>
      <td>-10.000000</td>
      <td>-30.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>node.12.maxobs</td>
      <td>22.000000</td>
      <td>22.000000</td>
      <td>22.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>node.12.ct</td>
      <td>0.010000</td>
      <td>0.010000</td>
      <td>0.010000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>node.12.censopt</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>node.12.calc_mod_m_s</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">moe</span> <span class="o">=</span> <span class="n">obj</span>
</code></pre></div>
<p>To get the overall weighted multiobjective score (for which lower is better)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">moe</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;MultisiteObjectives&#39;: 45093.298747974426},
 &#39;sysconfig&#39;:                     Name       Value        Min          Max
 0                 log_x4    0.305422   0.000000     2.380211
 1                 log_x1    0.506690   0.000000     3.778151
 2                 log_x3    0.315425   0.000000     3.000000
 3               asinh_x2    0.000000  -3.989327     3.989327
 4                     R0    0.900000   0.000000     1.000000
 5                     S0    0.900000   0.000000     1.000000
 6                  alpha    1.000000   0.001000   100.000000
 7       inverse_velocity    1.000000   0.001000   100.000000
 8               node.7.b   -7.000000 -30.000000     0.000000
 9               node.7.m    0.000000   0.000000     0.000000
 10              node.7.s  100.000000   1.000000  1000.000000
 11              node.7.a  -10.000000 -30.000000     1.000000
 12         node.7.maxobs   22.000000  22.000000    22.000000
 13             node.7.ct    0.010000   0.010000     0.010000
 14        node.7.censopt    0.000000   0.000000     0.000000
 15   node.7.calc_mod_m_s    1.000000   1.000000     1.000000
 16             node.12.b   -7.000000 -30.000000     0.000000
 17             node.12.m    0.000000   0.000000     0.000000
 18             node.12.s  100.000000   1.000000  1000.000000
 19             node.12.a  -10.000000 -30.000000     1.000000
 20        node.12.maxobs   22.000000  22.000000    22.000000
 21            node.12.ct    0.010000   0.010000     0.010000
 22       node.12.censopt    0.000000   0.000000     0.000000
 23  node.12.calc_mod_m_s    1.000000   1.000000     1.000000}
</code></pre></div>
<p>To get each individual log-likelihood scores for each gauge:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">moe</span><span class="o">.</span><span class="n">get_scores</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;node.12&#39;: np.float64(-44776.75651455558),
 &#39;node.7&#39;: np.float64(-45726.383214812144)}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 CSIRO
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>