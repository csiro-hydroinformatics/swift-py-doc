
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bindings to access the SWIFT2 libraries, from Python.">
      
      
        <meta name="author" content="Jean-Michel Perraud">
      
      
        <link rel="canonical" href="https://csiro-hydroinformatics.github.io/swift-py-doc/notebooks/muskingum_multilink_calibration/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Linear Muskingum channel routing model - constrained subcatchment calibration - swift2 - Python package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linear-muskingum-channel-routing-model-constrained-subcatchment-calibration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="swift2 - Python package" class="md-header__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            swift2 - Python package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Linear Muskingum channel routing model - constrained subcatchment calibration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classes/" class="md-tabs__link">
          
  
  
    
  
  Submodules

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting_started/" class="md-tabs__link">
          
  
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tech_notes/" class="md-tabs__link">
          
  
  
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="swift2 - Python package" class="md-nav__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    swift2 - Python package
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Submodules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Submodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../const/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    const
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    doc_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameteriser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameteriser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../play_record/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    play_record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prototypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with the swift python package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrating tied meta parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_model_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble SWIFT model runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_initial_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration with initial model memory states as parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_multisite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration of a catchment using multisite multiobjective composition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reservoir_geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reservoir geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_subcatchments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascaded calibration of subcatchments defined by multiple gauges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample code for log-likelihood calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linear Muskingum channel routing model - constrained subcatchment calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_correction_four_stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error correction models - ERRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tech_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guidelines-for-global-calibration-of-muskingum-constrainted-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Guidelines for global calibration of Muskingum constrainted parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-model-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Baseline model structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up calibration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seeding-the-optimisation-point-population-with-restrictive-constraint-bounds" class="md-nav__link">
    <span class="md-ellipsis">
      Seeding the optimisation point population with restrictive constraint bounds
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="linear-muskingum-channel-routing-model-constrained-subcatchment-calibration">Linear Muskingum channel routing model - constrained subcatchment calibration<a class="headerlink" href="#linear-muskingum-channel-routing-model-constrained-subcatchment-calibration" title="Permanent link">&para;</a></h1>
<h2 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h2>
<p>This vignette focuses on explaining how to calibrate the linear version of Muskingum jointly across river reaches, respecting stability constraints across all these reaches. The second part of the document is an indepth explanation of the scheme that is also used as a reference for unit testing swift.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">pkg_versions_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">pkg_versions_info</span><span class="p">(</span><span class="s2">&quot;This document was generated from a jupyter notebook&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>This document was generated from a jupyter notebook on 2025-03-27 17:26:28.496798
    swift2 2.5.1
    uchronia 2.6.2
</code></pre></div>
<h2 id="guidelines-for-global-calibration-of-muskingum-constrainted-parameters">Guidelines for global calibration of Muskingum constrainted parameters<a class="headerlink" href="#guidelines-for-global-calibration-of-muskingum-constrainted-parameters" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.wrap.swift_wrap_custom</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">swc</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Only temporary, under construction...</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">swift2.wrap.swift_wrap_generated</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">swg</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">TIME_DIMNAME</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">pd_series_to_xr_series</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">slice_xr_time_series</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">xr_ts_end</span><span class="p">,</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">xr_ts_start</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.play_record</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.simulation</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.statistics</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.system</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="c1"># from swift2.prototypes import extract_optimisation_log</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">uchronia.time_series</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_item</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<p>For this example we will use data derived from the South Esk catchment in Tasmania.</p>
<h2 id="baseline-model-structure">Baseline model structure<a class="headerlink" href="#baseline-model-structure" title="Permanent link">&para;</a></h2>
<p>We load and configure the model simulation in the next section, without detailed explanation; please read other introductory vignettes if this is unclear.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">model_id</span> <span class="o">=</span> <span class="s1">&#39;GR4J&#39;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">site_id</span> <span class="o">=</span> <span class="s1">&#39;South_Esk&#39;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">sample_catchment_model</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">config_id</span><span class="o">=</span><span class="s1">&#39;catchment&#39;</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">simulation</span> <span class="o">=</span> <span class="n">swap_model</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s1">&#39;MuskingumNonLinear&#39;</span><span class="p">,</span> <span class="s1">&#39;channel_routing&#39;</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1"># # revert back to derfautl values as expected from sample simulation..</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># sc = 1 # reach slope in m/m</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># n = 1  # default Manning&#39;s parameter value for the reach</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c1"># f = 1  # &quot;Fudge factor&quot; to allow for a different range of Alpha values. </span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1"># oneHour = 1</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="c1"># delt = oneHour</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">se_climate</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;climate&#39;</span><span class="p">)</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="n">se_flows</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;flow&#39;</span><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">play_input</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">se_climate</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="n">set_simulation_span</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">se_climate</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">se_climate</span><span class="p">))</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">set_simulation_time_step</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">)</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="n">configure_hourly_gr4j</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
</code></pre></div>
<p>We can get a topologic view of the model setup (albeit crowded as this is a fairly large catchment). </p>
<p>(Note: may not render yet through GitHub)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># TODO:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1"># from graphviz import Digraph</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># DiagrammeR(GetCatchmentDOTGraph_R(simulation))</span>
</code></pre></div>
<p>We cookie cut to get a subcatchment near the headwaters.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.model_definitions</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1"># from graphviz import Digraph</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">subsim</span> <span class="o">=</span> <span class="n">subset_catchment</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s1">&#39;node.5&#39;</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">subsim</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">dot_graph</span> <span class="o">=</span> <span class="n">swg</span><span class="o">.</span><span class="n">GetCatchmentDOTGraph_py</span><span class="p">(</span><span class="n">subsim</span><span class="p">)</span>
</code></pre></div>
<p>We configure the routing scheme to be linear (parameter N set and fixed to 1)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">link_ids</span> <span class="o">=</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">get_link_ids</span><span class="p">(</span><span class="n">subsim</span><span class="p">))</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">set_state_value</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="n">link_ids</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">),</span> <span class="n">rep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">link_ids</span><span class="p">)))</span>
</code></pre></div>
<p>Let's have a look at the link properties and other default routing parameters</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">lnkpnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;ManningsN&#39;</span><span class="p">,</span> <span class="s1">&#39;Slope&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">]</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">get_state_value</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span><span class="n">mk_full_data_id</span><span class="p">(</span><span class="s1">&#39;link.1&#39;</span><span class="p">,</span> <span class="n">lnkpnames</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;link.1.Length&#39;: 6140.0,
 &#39;link.1.f&#39;: 1.0,
 &#39;link.1.ManningsN&#39;: 1.0,
 &#39;link.1.Slope&#39;: 1.0,
 &#39;link.1.N&#39;: 1.0,
 &#39;link.1.X&#39;: 0.1,
 &#39;link.1.Alpha&#39;: 1.0}
</code></pre></div>
<p>X is between 0 and 0.5, without stability constraints. Setting a default Alpha is... trickier.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">set_state_value</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="n">link_ids</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="n">rep</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">link_ids</span><span class="p">)))</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">set_state_value</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="n">link_ids</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">),</span> <span class="n">rep</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">link_ids</span><span class="p">)))</span>
</code></pre></div>
<p>If we look at the subcatchment outflow in this configuration, it is a series of unfeasible values - at least one link was in an unfeasible zone for (Alpha, X)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.const</span><span class="w"> </span><span class="kn">import</span> <span class="n">CATCHMENT_FLOWRATE_VARID</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">var_id</span> <span class="o">=</span> <span class="n">CATCHMENT_FLOWRATE_VARID</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">catOutflowId</span> <span class="o">=</span> <span class="s1">&#39;subarea.1.OutflowRate&#39;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">record_state</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span><span class="n">var_id</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">record_state</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span><span class="n">catOutflowId</span><span class="p">)</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">exec_simulation</span><span class="p">(</span><span class="n">subsim</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">someFlow</span> <span class="o">=</span> <span class="n">get_recorded</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">var_id</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">someFlow</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (variable_identifiers: 1, ensemble: 1, time: 5)&gt; Size: 40B
array([[[0., 0., 0., 0., 0.]]])
Coordinates:
  * ensemble              (ensemble) int64 8B 0
  * time                  (time) datetime64[ns] 40B 2010-11-01 ... 2010-11-01...
  * variable_identifiers  (variable_identifiers) object 8B &#x27;Catchment.Streamf...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>variable_identifiers</span>: 1</li><li><span class='xr-has-index'>ensemble</span>: 1</li><li><span class='xr-has-index'>time</span>: 5</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-1e4ace4e-2df6-4d8c-8703-8ed5f45c3df8' class='xr-array-in' type='checkbox' checked><label for='section-1e4ace4e-2df6-4d8c-8703-8ed5f45c3df8' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[0., 0., 0., 0., 0.]]])</pre></div></div></li><li class='xr-section-item'><input id='section-65830689-5dda-456c-83da-c08a02e23bff' class='xr-section-summary-in' type='checkbox'  checked><label for='section-65830689-5dda-456c-83da-c08a02e23bff' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ensemble</span></div><div class='xr-var-dims'>(ensemble)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-d5b5e049-5ceb-414b-ae96-9c15eb45ddf1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d5b5e049-5ceb-414b-ae96-9c15eb45ddf1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5827c4cc-a935-43eb-a1a8-006f1d87809e' class='xr-var-data-in' type='checkbox'><label for='data-5827c4cc-a935-43eb-a1a8-006f1d87809e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-11-01 ... 2010-11-01T04:00:00</div><input id='attrs-f43766ec-0eaa-45e5-a6ef-1e55b5bda5aa' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f43766ec-0eaa-45e5-a6ef-1e55b5bda5aa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-410d8ce2-a3d1-4682-b769-0de888ee23bc' class='xr-var-data-in' type='checkbox'><label for='data-410d8ce2-a3d1-4682-b769-0de888ee23bc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-11-01T00:00:00.000000000&#x27;, &#x27;2010-11-01T01:00:00.000000000&#x27;,
       &#x27;2010-11-01T02:00:00.000000000&#x27;, &#x27;2010-11-01T03:00:00.000000000&#x27;,
       &#x27;2010-11-01T04:00:00.000000000&#x27;], dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>variable_identifiers</span></div><div class='xr-var-dims'>(variable_identifiers)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Catchment.StreamflowRate&#x27;</div><input id='attrs-a6c927f4-af76-4ff9-86b1-3a9943bd0bab' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a6c927f4-af76-4ff9-86b1-3a9943bd0bab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fa38fa07-bc76-4dc9-b924-3c5fa6a2fab6' class='xr-var-data-in' type='checkbox'><label for='data-fa38fa07-bc76-4dc9-b924-3c5fa6a2fab6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Catchment.StreamflowRate&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2291029e-2168-43d3-84e4-a365a2a60114' class='xr-section-summary-in' type='checkbox'  ><label for='section-2291029e-2168-43d3-84e4-a365a2a60114' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ensemble</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ee71d484-f942-4d8d-8c9d-38e2597666b7' class='xr-index-data-in' type='checkbox'/><label for='index-ee71d484-f942-4d8d-8c9d-38e2597666b7' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0], dtype=&#x27;int64&#x27;, name=&#x27;ensemble&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-210921a0-1ca3-4deb-9cbd-4299eabafcb3' class='xr-index-data-in' type='checkbox'/><label for='index-210921a0-1ca3-4deb-9cbd-4299eabafcb3' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2010-11-01 00:00:00&#x27;, &#x27;2010-11-01 01:00:00&#x27;,
               &#x27;2010-11-01 02:00:00&#x27;, &#x27;2010-11-01 03:00:00&#x27;,
               &#x27;2010-11-01 04:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=&#x27;h&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>variable_identifiers</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-b3799b9f-c603-4364-ad48-877fb857d703' class='xr-index-data-in' type='checkbox'/><label for='index-b3799b9f-c603-4364-ad48-877fb857d703' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;Catchment.StreamflowRate&#x27;], dtype=&#x27;object&#x27;, name=&#x27;variable_identifiers&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1bdcc868-12a6-4c51-848e-7d2415f1b18d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1bdcc868-12a6-4c51-848e-7d2415f1b18d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>

<p>We can double-check that the subarea does produce runoff yield; the links are where the model does not work yet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">get_state_value</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">get_variable_ids</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="s1">&#39;node.5&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;node.5.InflowRate&#39;: 7.942047038196456e-05,
 &#39;node.5.InflowVolume&#39;: 0.28591369337507244,
 &#39;node.5.AdditionalInflowRate&#39;: 0.0,
 &#39;node.5.OutflowRate&#39;: 7.942047038196456e-05,
 &#39;node.5.OutflowVolume&#39;: 0.28591369337507244}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">get_recorded</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">catOutflowId</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (variable_identifiers: 1, ensemble: 1, time: 5)&gt; Size: 40B
array([[[0., 0., 0., 0., 0.]]])
Coordinates:
  * ensemble              (ensemble) int64 8B 0
  * time                  (time) datetime64[ns] 40B 2010-11-01 ... 2010-11-01...
  * variable_identifiers  (variable_identifiers) object 8B &#x27;subarea.1.Outflow...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>variable_identifiers</span>: 1</li><li><span class='xr-has-index'>ensemble</span>: 1</li><li><span class='xr-has-index'>time</span>: 5</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-51a5ed4d-7d75-4d77-8457-73574a8274af' class='xr-array-in' type='checkbox' checked><label for='section-51a5ed4d-7d75-4d77-8457-73574a8274af' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>0.0 0.0 0.0 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[0., 0., 0., 0., 0.]]])</pre></div></div></li><li class='xr-section-item'><input id='section-2fde3415-c86f-4c29-a61d-1a740d5992cd' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2fde3415-c86f-4c29-a61d-1a740d5992cd' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ensemble</span></div><div class='xr-var-dims'>(ensemble)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-0b09a438-4840-404b-883a-0bd56adfe34c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0b09a438-4840-404b-883a-0bd56adfe34c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-54e4d0cb-1b7b-4210-9aa4-b3a20f63466e' class='xr-var-data-in' type='checkbox'><label for='data-54e4d0cb-1b7b-4210-9aa4-b3a20f63466e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-11-01 ... 2010-11-01T04:00:00</div><input id='attrs-c0c76511-b8ac-4a9f-8e07-ca85e6c3746d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c0c76511-b8ac-4a9f-8e07-ca85e6c3746d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9153c586-f68f-4b8d-8974-2447d5bc776c' class='xr-var-data-in' type='checkbox'><label for='data-9153c586-f68f-4b8d-8974-2447d5bc776c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-11-01T00:00:00.000000000&#x27;, &#x27;2010-11-01T01:00:00.000000000&#x27;,
       &#x27;2010-11-01T02:00:00.000000000&#x27;, &#x27;2010-11-01T03:00:00.000000000&#x27;,
       &#x27;2010-11-01T04:00:00.000000000&#x27;], dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>variable_identifiers</span></div><div class='xr-var-dims'>(variable_identifiers)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;subarea.1.OutflowRate&#x27;</div><input id='attrs-fd400c39-c35e-416b-8b78-d8590cd845dc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fd400c39-c35e-416b-8b78-d8590cd845dc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5a97d751-6885-408e-90ba-b4b8839448cc' class='xr-var-data-in' type='checkbox'><label for='data-5a97d751-6885-408e-90ba-b4b8839448cc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;subarea.1.OutflowRate&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-db07318b-6cf8-48b9-909c-11dd1c7ed582' class='xr-section-summary-in' type='checkbox'  ><label for='section-db07318b-6cf8-48b9-909c-11dd1c7ed582' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ensemble</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-35db44e9-88c1-4e3f-981b-9b0f97d1733b' class='xr-index-data-in' type='checkbox'/><label for='index-35db44e9-88c1-4e3f-981b-9b0f97d1733b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0], dtype=&#x27;int64&#x27;, name=&#x27;ensemble&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-19498056-636a-486a-8342-dca08de36d6c' class='xr-index-data-in' type='checkbox'/><label for='index-19498056-636a-486a-8342-dca08de36d6c' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2010-11-01 00:00:00&#x27;, &#x27;2010-11-01 01:00:00&#x27;,
               &#x27;2010-11-01 02:00:00&#x27;, &#x27;2010-11-01 03:00:00&#x27;,
               &#x27;2010-11-01 04:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=&#x27;h&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>variable_identifiers</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-34073ef3-d4fd-4ce2-8aea-0b90b82b7ac6' class='xr-index-data-in' type='checkbox'/><label for='index-34073ef3-d4fd-4ce2-8aea-0b90b82b7ac6' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;subarea.1.OutflowRate&#x27;], dtype=&#x27;object&#x27;, name=&#x27;variable_identifiers&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6758b286-de7e-4875-99cb-a5bc5f93616c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6758b286-de7e-4875-99cb-a5bc5f93616c' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>

<p>So, given that each routing link parameters Alpha and X are subject to constraint that vary depending on 'Length', 'f', 'ManningsN', 'Slope', how do we get a pair (Alpha, X) that globaly respect these constraints? This is not complex science but complicated enough to get wrong.</p>
<p>'swift' offers facilities to remove the error prone tedium. First, <code>feasibleMuskingumBounds</code> lists the extremas of the feasible (Alpha, X) parameter space.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">akbounds</span> <span class="o">=</span> <span class="n">feasible_muskingum_bounds</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">akbounds</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;min_alpha&#39;: np.float64(0.08143322475570032),
 &#39;max_x&#39;: np.float64(0.37382039573820397),
 &#39;alpha_for_max_x&#39;: np.float64(0.13004771187286124)}
</code></pre></div>
<p>The numbers above can play a <em>crucial</em> role when setting up an optimiser for this model; more on this soon.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">oneHour</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">pSpecMusk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">],</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>  <span class="n">Value</span> <span class="o">=</span> <span class="p">[</span><span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;max_x&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;alpha_for_max_x&#39;</span><span class="p">]],</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>  <span class="n">Min</span><span class="o">=</span> <span class="p">[</span><span class="mf">1.0E-06</span><span class="p">,</span> <span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;min_alpha&#39;</span><span class="p">]],</span>   
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>  <span class="n">Max</span> <span class="o">=</span> <span class="p">[</span><span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;max_x&#39;</span><span class="p">],</span> <span class="mf">1e5</span><span class="p">])</span> 
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">)</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="c1"># Basic parameteriser</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">pzm</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">pSpecs</span><span class="o">=</span><span class="n">pSpecMusk</span><span class="p">):</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="n">akbounds</span> <span class="o">=</span> <span class="n">feasible_muskingum_bounds</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="n">p_musk</span> <span class="o">=</span> <span class="n">create_parameteriser</span><span class="p">(</span><span class="s1">&#39;generic links&#39;</span><span class="p">,</span><span class="n">pSpecs</span><span class="p">)</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>    <span class="k">return</span> <span class="n">p_musk</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="c1"># Wrapper parameteriser, with constraints added around.</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">pzc</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">pSpecs</span><span class="o">=</span><span class="n">pSpecMusk</span><span class="p">):</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>    <span class="n">p_musk</span> <span class="o">=</span> <span class="n">pzm</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">pSpecs</span><span class="p">)</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>    <span class="n">p_musk_c</span> <span class="o">=</span> <span class="n">create_muskingum_param_constraints</span><span class="p">(</span><span class="n">p_musk</span><span class="p">,</span> <span class="n">oneHour</span><span class="p">,</span> <span class="s2">&quot;Alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">simulation</span><span class="p">)</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>    <span class="k">return</span> <span class="n">p_musk_c</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="n">pp</span> <span class="o">=</span> <span class="n">parameteriser_as_dataframe</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">pp</span><span class="p">(</span><span class="n">pzm</span><span class="p">(</span><span class="n">subsim</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.186910</td>
      <td>0.000001</td>
      <td>0.37382</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130048</td>
      <td>0.081433</td>
      <td>100000.00000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">pzc</span><span class="p">(</span><span class="n">subsim</span><span class="p">)</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">pp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.186910</td>
      <td>0.000001</td>
      <td>0.373820</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130048</td>
      <td>0.100153</td>
      <td>0.260095</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's get a trace of the subcatchment outflow, as a synthetic data to calibrated against.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">subsim</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">exec_simulation</span><span class="p">(</span><span class="n">subsim</span><span class="p">)</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">someFlow</span> <span class="o">=</span> <span class="n">get_recorded</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">var_id</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">someFlow</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>count    4.800000e+02
mean     6.164971e-03
std      2.694368e-02
min      0.000000e+00
25%      8.691205e-07
50%      8.687524e-05
75%      6.349944e-04
max      2.682614e-01
dtype: float64
</code></pre></div>
<p>We do now get a valid outflow since (Alpha-K) respects feasibility constraints on all links.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">someFlow</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</code></pre></div>
<p><img alt="png" src="../muskingum_multilink_calibration_files/muskingum_multilink_calibration_40_0.png" /></p>
<h2 id="setting-up-calibration">Setting up calibration<a class="headerlink" href="#setting-up-calibration" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">pSpecMaxBounds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>  <span class="n">Name</span> <span class="o">=</span>  <span class="n">c</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>     <span class="s1">&#39;Alpha&#39;</span><span class="p">),</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>  <span class="n">Value</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mf">1.0E-6</span><span class="p">,</span> <span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;alpha_for_max_x&#39;</span><span class="p">]),</span> <span class="c1"># IMPORTANT to use these values.</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>  <span class="n">Min</span><span class="o">=</span>    <span class="n">c</span><span class="p">(</span><span class="mf">1.0E-6</span><span class="p">,</span> <span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;min_alpha&#39;</span><span class="p">]),</span>   
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>  <span class="n">Max</span> <span class="o">=</span>   <span class="n">c</span><span class="p">(</span><span class="n">akbounds</span><span class="p">[</span><span class="s1">&#39;max_x&#39;</span><span class="p">],</span> <span class="mf">1e6</span><span class="p">),</span> <span class="c1"># Alpha_max can get very large. </span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="p">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>                             <span class="p">)</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="n">pp</span><span class="p">(</span><span class="n">pzc</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">pSpecMaxBounds</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.000001</td>
      <td>0.000001</td>
      <td>0.373820</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130048</td>
      <td>0.081433</td>
      <td>48614.487117</td>
    </tr>
  </tbody>
</table>
</div>

<p>If we were to use another (X, Alpha) point e.g. X=0.1869102, the feasible bounds for Alpha change drastically. If an optimiser samples this for an initial population of points (SCE), this is unnecessarily restrictive for Alpha. Many hydrological calibration schemes were designed without consideration on feasible space that are not hypercubes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">pp</span><span class="p">(</span><span class="n">pzc</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">pSpecMusk</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.186910</td>
      <td>0.000001</td>
      <td>0.373820</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130048</td>
      <td>0.100153</td>
      <td>0.260095</td>
    </tr>
  </tbody>
</table>
</div>

<p>While calibrating in the (Alpha,X) space is possible, perhaps preferable in some cases, (1/Alpha,X) has a triangular shaped feasibility region that may be easier to handle for optimisers that work with geometric transformation in the parameter space (SCE). Swift can add this on top of the constrained calibration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># (X, 1/Alpha) parametrizer with dynamically constrained min/max bounds.</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">pzer_inv</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">pSpecs</span><span class="o">=</span><span class="n">pSpecMusk</span><span class="p">):</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="n">p_musk_c</span> <span class="o">=</span> <span class="n">pzc</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">pSpecs</span><span class="p">)</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="n">p_musk_inv_a</span> <span class="o">=</span> <span class="n">wrap_transform</span><span class="p">(</span><span class="n">p_musk_c</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="n">add_transform</span><span class="p">(</span><span class="n">p_musk_inv_a</span><span class="p">,</span> <span class="s1">&#39;inv_alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;1/x&#39;</span><span class="p">)</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="k">return</span> <span class="n">p_musk_inv_a</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="n">p</span> <span class="o">=</span> <span class="n">pzer_inv</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">pSpecMaxBounds</span><span class="p">)</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="n">pp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>inv_alpha</td>
      <td>7.689486</td>
      <td>0.000021</td>
      <td>12.279988</td>
    </tr>
    <tr>
      <th>1</th>
      <td>X</td>
      <td>0.000001</td>
      <td>0.000001</td>
      <td>0.373820</td>
    </tr>
  </tbody>
</table>
</div>

<p>We check that backtransforming to (Alpha-X) works:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">pp</span><span class="p">(</span><span class="n">backtransform</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.000001</td>
      <td>0.000001</td>
      <td>0.373820</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130048</td>
      <td>0.081433</td>
      <td>48614.487117</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">someFlow</span> <span class="o">=</span> <span class="n">someFlow</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">objectiveId</span> <span class="o">=</span> <span class="s1">&#39;NSE&#39;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">objective</span> <span class="o">=</span> <span class="n">create_objective</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">var_id</span><span class="p">,</span> <span class="n">someFlow</span><span class="p">,</span> <span class="n">objectiveId</span><span class="p">,</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">someFlow</span><span class="p">),</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">someFlow</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">score</span> <span class="o">=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE&#39;: 0.9997748469565144},
 &#39;sysconfig&#39;:         Name     Value       Min        Max
 0  inv_alpha  7.689486  0.000021  12.279988
 1          X  0.000001  0.000001   0.373820}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">#termination = swift::CreateSceMaxRuntimeTerminationWila_R(1/60)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">termination</span> <span class="o">=</span> <span class="n">create_sce_termination_wila</span><span class="p">(</span><span class="s1">&#39;relative standard deviation&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;0.001&#39;</span><span class="p">,</span><span class="s1">&#39;0.0167&#39;</span><span class="p">))</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="n">npars</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sce_parameter</span><span class="p">(</span><span class="n">npars</span><span class="p">)</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span><span class="n">termination_criterion</span> <span class="o">=</span> <span class="n">termination</span><span class="p">,</span> <span class="n">population_initialiser</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sce_params</span><span class="p">)</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">calib_logger</span> <span class="o">=</span> <span class="n">set_calibration_logger</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">execute_optimisation</span><span class="p">(</span><span class="n">optimiser</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CPU times: user 999 ms, sys: 4.36 ms, total: 1 s
Wall time: 324 ms
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">opt_log</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">extract_optimisation_log</span><span class="p">(</span><span class="n">fitness_name</span> <span class="o">=</span> <span class="s2">&quot;NSE&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.vis</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimisationPlots</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">shuffleLogs</span> <span class="o">=</span> <span class="n">opt_log</span><span class="o">.</span><span class="n">subset_by_message</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;Initial.*|Shuffling.*&quot;</span><span class="p">)</span> 
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">shuffleLogs</span><span class="o">.</span><span class="n">data</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Category</th>
      <th>CurrentShuffle</th>
      <th>Message</th>
      <th>NSE</th>
      <th>X</th>
      <th>inv_alpha</th>
      <th>PointNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>0.999286</td>
      <td>0.330241</td>
      <td>11.636989</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>0.979734</td>
      <td>0.251643</td>
      <td>0.752518</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>0.993863</td>
      <td>0.141551</td>
      <td>2.133362</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>0.999939</td>
      <td>0.149201</td>
      <td>8.721001</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>0.995707</td>
      <td>0.142863</td>
      <td>2.626987</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1117</th>
      <td>Shuffling No 6</td>
      <td></td>
      <td>Shuffling No 6</td>
      <td>1.000000</td>
      <td>0.186814</td>
      <td>7.690154</td>
      <td>1118</td>
    </tr>
    <tr>
      <th>1118</th>
      <td>Shuffling No 6</td>
      <td></td>
      <td>Shuffling No 6</td>
      <td>1.000000</td>
      <td>0.186973</td>
      <td>7.686830</td>
      <td>1119</td>
    </tr>
    <tr>
      <th>1119</th>
      <td>Shuffling No 6</td>
      <td></td>
      <td>Shuffling No 6</td>
      <td>1.000000</td>
      <td>0.186925</td>
      <td>7.690300</td>
      <td>1120</td>
    </tr>
    <tr>
      <th>1120</th>
      <td>Shuffling No 6</td>
      <td></td>
      <td>Shuffling No 6</td>
      <td>1.000000</td>
      <td>0.187077</td>
      <td>7.691259</td>
      <td>1121</td>
    </tr>
    <tr>
      <th>1121</th>
      <td>Shuffling No 6</td>
      <td></td>
      <td>Shuffling No 6</td>
      <td>1.000000</td>
      <td>0.186800</td>
      <td>7.694139</td>
      <td>1122</td>
    </tr>
  </tbody>
</table>
<p>140 rows  7 columns</p>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">v</span> <span class="o">=</span> <span class="n">OptimisationPlots</span><span class="p">(</span><span class="n">shuffleLogs</span><span class="p">)</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">g</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shuffles</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;inv_alpha&#39;</span><span class="p">,</span> <span class="n">obj_lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../muskingum_multilink_calibration_files/muskingum_multilink_calibration_56_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">sortedResults</span> <span class="o">=</span> <span class="n">sort_by_score</span><span class="p">(</span><span class="n">calib_results</span><span class="p">,</span> <span class="s1">&#39;NSE&#39;</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">scores_as_dataframe</span><span class="p">(</span><span class="n">sortedResults</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NSE</th>
      <th>inv_alpha</th>
      <th>X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>7.689032</td>
      <td>0.186874</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>7.690300</td>
      <td>0.186925</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>7.690382</td>
      <td>0.186887</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>7.690224</td>
      <td>0.186842</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>7.689243</td>
      <td>0.186813</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">q</span> <span class="o">=</span> <span class="n">get_best_score</span><span class="p">(</span><span class="n">calib_results</span><span class="p">,</span> <span class="s1">&#39;NSE&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">q</span> <span class="o">=</span> <span class="n">swg</span><span class="o">.</span><span class="n">GetSystemConfigurationWila_py</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">pp</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>inv_alpha</td>
      <td>7.689032</td>
      <td>3.844007</td>
      <td>9.985182</td>
    </tr>
    <tr>
      <th>1</th>
      <td>X</td>
      <td>0.186874</td>
      <td>0.000001</td>
      <td>0.373798</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">pp</span><span class="p">(</span><span class="n">backtransform</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.186874</td>
      <td>0.000001</td>
      <td>0.373798</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.130055</td>
      <td>0.100148</td>
      <td>0.260145</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="seeding-the-optimisation-point-population-with-restrictive-constraint-bounds">Seeding the optimisation point population with restrictive constraint bounds<a class="headerlink" href="#seeding-the-optimisation-point-population-with-restrictive-constraint-bounds" title="Permanent link">&para;</a></h2>
<p>This section is a <em>counter-example</em>. Do not do this.</p>
<p>Say, instead of seeding with alpha set to alpha_for_x_max (0.37382040) we instead use a value close to its global minimum, 0.083:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">pSpecRestrictiveBounds</span> <span class="o">=</span> <span class="n">pSpecMaxBounds</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">pSpecRestrictiveBounds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pSpecRestrictiveBounds</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.083</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">pSpecRestrictiveBounds</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>0.000001</td>
      <td>0.000001</td>
      <td>0.37382</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alpha</td>
      <td>0.083000</td>
      <td>0.081433</td>
      <td>1000000.00000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">pzer_inv</span><span class="p">(</span><span class="n">subsim</span><span class="p">,</span> <span class="n">pSpecRestrictiveBounds</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">pp</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>inv_alpha</td>
      <td>12.048193</td>
      <td>0.000021</td>
      <td>12.279988</td>
    </tr>
    <tr>
      <th>1</th>
      <td>X</td>
      <td>0.000001</td>
      <td>0.000001</td>
      <td>0.018877</td>
    </tr>
  </tbody>
</table>
</div>

<p>X is now much more constrained in its feasible range, and initializing a population fails to cover large sections of the feasible triangle. If used in the optimiser (uniform random sampling)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">termination</span> <span class="o">=</span> <span class="n">create_sce_termination_wila</span><span class="p">(</span><span class="s1">&#39;relative standard deviation&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;0.001&#39;</span><span class="p">,</span><span class="s1">&#39;0.0167&#39;</span><span class="p">))</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">get_default_sce_parameters</span><span class="p">()</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="n">npars</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sce_parameter</span><span class="p">(</span><span class="n">npars</span><span class="p">)</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span><span class="n">termination_criterion</span> <span class="o">=</span> <span class="n">termination</span><span class="p">,</span> <span class="n">population_initialiser</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span><span class="n">sce_params</span> <span class="o">=</span> <span class="n">sce_params</span><span class="p">)</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="n">calib_logger</span> <span class="o">=</span> <span class="n">set_calibration_logger</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">execute_optimisation</span><span class="p">(</span><span class="n">optimiser</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">opt_log</span> <span class="o">=</span> <span class="n">extract_optimisation_log</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span> <span class="n">fitness_name</span> <span class="o">=</span> <span class="s2">&quot;NSE&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">shuffleLogs</span> <span class="o">=</span> <span class="n">opt_log</span><span class="o">.</span><span class="n">subset_by_message</span><span class="p">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;Initial.*|Shuffling.*&quot;</span><span class="p">)</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">v</span> <span class="o">=</span> <span class="n">OptimisationPlots</span><span class="p">(</span><span class="n">shuffleLogs</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">g</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shuffles</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;inv_alpha&#39;</span><span class="p">,</span> <span class="n">obj_lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../muskingum_multilink_calibration_files/muskingum_multilink_calibration_68_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># shuffleLogs = mhplot::subsetByCategory(opt_log$data, pattern = &quot;Initial.*|Shuffling.*&quot;) </span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="c1"># mhplot::plotShuffles(shuffleLogs, &#39;X&#39;, &#39;inv_alpha&#39;, obj_lims = (0:1))</span>
</code></pre></div>
<p>SCE does manage to converge towards the optimum, but it takes a larger number of iterations. Anecdotally, we observed cases where the calibration does fail to go near the optimum, when interplaying with a convergence criterion configured for "leniency".</p>
<h1 id="detailed-explanation-and-unit-test-design">Detailed explanation and unit test design<a class="headerlink" href="#detailed-explanation-and-unit-test-design" title="Permanent link">&para;</a></h1>
<p>See other document <a href="./muskingum_multilink_calibration_explanation.ipynb">muskingum_multilink_calibration_explanation.ipynb</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 CSIRO
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>