
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bindings to access the SWIFT2 libraries, from Python.">
      
      
        <meta name="author" content="Jean-Michel Perraud">
      
      
        <link rel="canonical" href="https://csiro-hydroinformatics.github.io/swift-py-doc/notebooks/meta_parameters/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Calibrating tied meta parameters - swift2 - Python package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calibrating-tied-meta-parameters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="swift2 - Python package" class="md-header__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            swift2 - Python package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Calibrating tied meta parameters
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classes/" class="md-tabs__link">
          
  
  
    
  
  Submodules

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting_started/" class="md-tabs__link">
          
  
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tech_notes/" class="md-tabs__link">
          
  
  
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="swift2 - Python package" class="md-nav__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    swift2 - Python package
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Submodules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Submodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../const/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    const
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    doc_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameteriser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameteriser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../play_record/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    play_record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prototypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with the swift python package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrating tied meta parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_model_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble SWIFT model runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_initial_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration with initial model memory states as parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_multisite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration of a catchment using multisite multiobjective composition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reservoir_geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reservoir geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_subcatchments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascaded calibration of subcatchments defined by multiple gauges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample code for log-likelihood calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../muskingum_multilink_calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linear Muskingum channel routing model - constrained subcatchment calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_correction_four_stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error correction models - ERRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tech_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-this-document" class="md-nav__link">
    <span class="md-ellipsis">
      About this document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-case-and-sample-data" class="md-nav__link">
    <span class="md-ellipsis">
      Use case and sample data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-synthetic-but-realistic-model" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a synthetic but realistic model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#channel-routing" class="md-nav__link">
    <span class="md-ellipsis">
      channel routing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assign-simulation-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Assign simulation inputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-a-calibration-time-span" class="md-nav__link">
    <span class="md-ellipsis">
      Define a calibration time span
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gr4j-gr4h-modes" class="md-nav__link">
    <span class="md-ellipsis">
      GR4J (GR4H) modes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feasible-parameter-space-and-parsimony" class="md-nav__link">
    <span class="md-ellipsis">
      Feasible parameter space and parsimony
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimiser" class="md-nav__link">
    <span class="md-ellipsis">
      Optimiser
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="calibrating-tied-meta-parameters">Calibrating tied meta parameters<a class="headerlink" href="#calibrating-tied-meta-parameters" title="Permanent link">&para;</a></h1>
<h2 id="about-this-document">About this document<a class="headerlink" href="#about-this-document" title="Permanent link">&para;</a></h2>
<p>This document illustrates how to set up a calibration where a global parameterization is set at the catchment level, with scaled values for each subareas. This method helps to keep the degrees of freedom of an optimisation to a minimum.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">pkg_versions_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">pkg_versions_info</span><span class="p">(</span><span class="s2">&quot;This document was generated from a jupyter notebook&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>This document was generated from a jupyter notebook on 2025-03-27 17:26:06.548624
    swift2 2.5.1
    uchronia 2.6.2
</code></pre></div>
<h2 id="use-case-and-sample-data">Use case and sample data<a class="headerlink" href="#use-case-and-sample-data" title="Permanent link">&para;</a></h2>
<p>This workflow uses for convenience hourly time series data gathered a decade ago. The data comes from the Ovens River catchment, however the provenance is unclear</p>
<h2 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_timestamp</span><span class="p">,</span> <span class="n">xr_ts_end</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">configure_daily_gr4j</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">configure_hourly_gr4j</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">create_test_catchment_structure</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">get_free_params</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">gr4j_scaled_parameteriser</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">sample_series</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">create_parameter_sampler</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">create_sce_optim_swift</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">get_default_sce_parameters</span><span class="p">,</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">get_marginal_termination</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">set_calibration_logger</span><span class="p">,</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="p">)</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.simulation</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_state_value</span><span class="p">,</span> <span class="n">get_subarea_ids</span><span class="p">,</span> <span class="n">swap_model</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">as_xarray_series</span><span class="p">,</span> <span class="n">mk_full_data_id</span><span class="p">,</span> <span class="n">paste</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.vis</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimisationPlots</span><span class="p">,</span> <span class="n">plot_two_series</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<h2 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h2>
<p>The sample data for this tutorial are daily series for the Ovens Catchment in Victoria. Daily streamflow was sourced from https://data.water.vic.gov.au/ at Bright (VIC), and rainfall and morton PET were sourced from  https://www.longpaddock.qld.gov.au/silo/point-data/  at Eurobin (VIC). Note that Eurobin is a bit downstream from Bright and perhaps not the "best" point climate data, but this works for this present vignette.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">loc_key</span> <span class="o">=</span> <span class="s2">&quot;Ovens-Bright&quot;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">daily_rain</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="n">loc_key</span><span class="p">,</span> <span class="s2">&quot;rain&quot;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">daily_pet</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="n">loc_key</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">daily_streamflow_mlday</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="n">loc_key</span><span class="p">,</span> <span class="s2">&quot;streamflow&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">daily_streamflow_mlday</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</code></pre></div>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_9_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">catchment_area</span> <span class="o">=</span> <span class="mi">495</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">daily_runoff</span> <span class="o">=</span> <span class="n">daily_streamflow_mlday</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="p">(</span><span class="n">catchment_area</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">daily_runoff</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</code></pre></div>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_11_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">daily_cumecs</span> <span class="o">=</span> <span class="n">daily_streamflow_mlday</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">86400</span> <span class="c1"># ML/day to m3/s</span>
</code></pre></div>
<h2 id="creating-a-synthetic-but-realistic-model">Creating a synthetic but realistic model<a class="headerlink" href="#creating-a-synthetic-but-realistic-model" title="Permanent link">&para;</a></h2>
<p>We create a system with total area similar to the real use case, but we use an arbitrary test catchment structure (multiple subareas). This is suitable for this tutorial.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">areas_portions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">91</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">93</span><span class="p">])</span> <span class="c1"># arbitrary weights.</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">areas_portions</span> <span class="o">=</span> <span class="n">areas_portions</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">areas_portions</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">areasKm2</span> <span class="o">=</span> <span class="n">areas_portions</span> <span class="o">*</span> <span class="n">catchment_area</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nb">sum</span><span class="p">(</span><span class="n">areasKm2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>np.float64(495.0)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">summary</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="n">create_test_catchment_structure</span><span class="p">(</span><span class="n">areas_km2</span><span class="o">=</span><span class="n">areasKm2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">summary</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;node_ids&#39;: [&#39;n1&#39;, &#39;n2&#39;, &#39;n3&#39;, &#39;n4&#39;, &#39;n5&#39;, &#39;n6&#39;],
 &#39;node_names&#39;: [&#39;n1_name&#39;,
  &#39;n2_name&#39;,
  &#39;n3_name&#39;,
  &#39;n4_name&#39;,
  &#39;n5_name&#39;,
  &#39;n6_name&#39;],
 &#39;link_ids&#39;: [&#39;lnk1&#39;, &#39;lnk2&#39;, &#39;lnk3&#39;, &#39;lnk4&#39;, &#39;lnk5&#39;],
 &#39;link_names&#39;: [&#39;lnk1_name&#39;,
  &#39;lnk2_name&#39;,
  &#39;lnk3_name&#39;,
  &#39;lnk4_name&#39;,
  &#39;lnk5_name&#39;],
 &#39;from_node&#39;: [&#39;n2&#39;, &#39;n5&#39;, &#39;n4&#39;, &#39;n3&#39;, &#39;n1&#39;],
 &#39;to_node&#39;: [&#39;n6&#39;, &#39;n2&#39;, &#39;n2&#39;, &#39;n4&#39;, &#39;n4&#39;],
 &#39;areas_km2&#39;: array([109.06779661, 113.86198547,   7.19128329, 153.41404358,
        111.46489104]),
 &#39;runoff_model&#39;: &#39;GR4J&#39;}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">sum</span><span class="p">(</span><span class="n">areasKm2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>np.float64(495.0)
</code></pre></div>
<h2 id="channel-routing">channel routing<a class="headerlink" href="#channel-routing" title="Permanent link">&para;</a></h2>
<p>This is besides the main point of this tutorial, but let's take a detour showing how to set up a uniform channel routing using a pure lag routing.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">ms</span> <span class="o">=</span> <span class="n">swap_model</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="s2">&quot;PureLag&quot;</span><span class="p">,</span> <span class="s2">&quot;channel_routing&quot;</span><span class="p">)</span>
</code></pre></div>
<p><code>PureLag</code> has a <code>Tau</code> parameter that can be a positive floating point value. If we query the variable identifiers of one of the links now:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_variable_ids</span><span class="p">(</span><span class="s1">&#39;link.lnk1&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;link.lnk1.Length&#39;,
 &#39;link.lnk1.f&#39;,
 &#39;link.lnk1.ManningsN&#39;,
 &#39;link.lnk1.Slope&#39;,
 &#39;link.lnk1.LateralInflowRate&#39;,
 &#39;link.lnk1.LateralInflowVolume&#39;,
 &#39;link.lnk1.Tau&#39;,
 &#39;link.lnk1.PreviousUpstreamInflowRate&#39;,
 &#39;link.lnk1.PreviousLateralInflowRate&#39;,
 &#39;link.lnk1.PreviousOutflowRate&#39;,
 &#39;link.lnk1.PreviousStorage&#39;,
 &#39;link.lnk1.UpstreamInflowRate&#39;,
 &#39;link.lnk1.OutflowRate&#39;,
 &#39;link.lnk1.Storage&#39;,
 &#39;link.lnk1.InflowRate&#39;,
 &#39;link.lnk1.InflowVolume&#39;,
 &#39;link.lnk1.AdditionalInflowRate&#39;,
 &#39;link.lnk1.OutflowVolume&#39;]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_parameteriser</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Tau&quot;</span><span class="p">],</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">],</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="s2">&quot;Min&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">],</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="s2">&quot;Max&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">],</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="p">})</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">pure_lag_six_hours</span> <span class="o">=</span> <span class="n">create_parameteriser</span><span class="p">(</span><span class="s1">&#39;generic links&#39;</span><span class="p">,</span> <span class="n">specs</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="s1">&#39;link.lnk1.Tau&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;link.lnk1.Tau&#39;: 0.0}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">pure_lag_six_hours</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="s1">&#39;link.lnk1.Tau&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;link.lnk1.Tau&#39;: 0.25}
</code></pre></div>
<p>We will run over a few years and calibrate with a warmup of two years.</p>
<h2 id="assign-simulation-inputs">Assign simulation inputs<a class="headerlink" href="#assign-simulation-inputs" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">sa_ids</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_subarea_ids</span><span class="p">()</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">rainfall_ids</span> <span class="o">=</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="s1">&#39;subarea&#39;</span><span class="p">,</span> <span class="n">sa_ids</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">evap_ids</span> <span class="o">=</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="s1">&#39;subarea&#39;</span><span class="p">,</span> <span class="n">sa_ids</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="n">rainfall_ids</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.P&#39;: 0.0,
 &#39;subarea.lnk2.P&#39;: 0.0,
 &#39;subarea.lnk3.P&#39;: 0.0,
 &#39;subarea.lnk4.P&#39;: 0.0,
 &#39;subarea.lnk5.P&#39;: 0.0}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">for</span> <span class="n">rids</span> <span class="ow">in</span> <span class="n">rainfall_ids</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="n">ms</span><span class="o">.</span><span class="n">play_input</span><span class="p">(</span><span class="n">daily_rain</span><span class="p">,</span> <span class="n">rids</span><span class="p">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">for</span> <span class="n">evids</span> <span class="ow">in</span> <span class="n">evap_ids</span><span class="p">:</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="n">ms</span><span class="o">.</span><span class="n">play_input</span><span class="p">(</span><span class="n">daily_pet</span><span class="p">,</span> <span class="n">evids</span><span class="p">)</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">ms</span><span class="o">.</span><span class="n">set_simulation_time_step</span><span class="p">(</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="define-a-calibration-time-span">Define a calibration time span<a class="headerlink" href="#define-a-calibration-time-span" title="Permanent link">&para;</a></h2>
<p>We define a calibration with objective calculation over 10 years, plus a 2-year warmup period </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">e</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2024-12-31&quot;</span><span class="p">)</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">w</span> <span class="o">=</span> <span class="n">e</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">s</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calibration run: simulation from </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, with a warmup till </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Calibration run: simulation from 2012-12-31 00:00:00 to 2024-12-31 00:00:00, with a warmup till 2014-12-31 00:00:00
</code></pre></div>
<p>The package includes a function that flags possible inconsistencies prior to running a model (inconsistent time steps, etc.)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">check_simulation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;errors&#39;: [&#39;subarea.lnk1.E: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk1.P: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk2.E: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk2.P: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk3.E: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk3.P: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk4.E: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk4.P: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk5.E: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;,
  &#39;subarea.lnk5.P: End 2025-02-25T00:00:00 &lt; test date not-a-date-time&#39;]}
</code></pre></div>
<p>We need to adjust a couple of parameters for proper operation on hourly data for the GR4 model structure.</p>
<p>Wait what? The message is admitedly not the clearest, but in this case, we have not yet set a the simulation time span</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">set_simulation_span</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>
<p>Now, the check can compare simulation span and time series spans, and finds no problem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">check_simulation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;errors&#39;: []}
</code></pre></div>
<h2 id="gr4j-gr4h-modes">GR4J (GR4H) modes<a class="headerlink" href="#gr4j-gr4h-modes" title="Permanent link">&para;</a></h2>
<p>GR4J (j for "journalier" i.e. "daily") and GR4H (h for hourly) differ by the values of tso parameters. There are two helper functions to switch modes on all GR4J models in the system</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">configure_hourly_gr4j</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="s2">&quot;subarea.lnk1.UHExponent&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.UHExponent&#39;: 1.25}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">configure_daily_gr4j</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="s2">&quot;subarea.lnk1.UHExponent&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.UHExponent&#39;: 2.5}
</code></pre></div>
<h2 id="feasible-parameter-space-and-parsimony">Feasible parameter space and parsimony<a class="headerlink" href="#feasible-parameter-space-and-parsimony" title="Permanent link">&para;</a></h2>
<p>We have a catchment with 5 subareas, with GR4J. Leaving outside the links which we will not calibrate, this still means 20 parameters overall to calibrate. This can be problematic as there is likely an inflated parameter equifinality (many different combinations leading to sensibly similar performances), and the resulting parameters may not be robust or physically sensible.</p>
<p>Instead, we can define a meta parameter set with only 4 degrees of freedom, with area scaling applied to x4 and time scaling applied to x2 and x3. The time scaling makes it invariant if the simulation time step changes from daily to hourly, but in this sample the most telling scaling is the one for the "lag parameter" <code>x4</code>. A single <code>x4</code> meta-parameter is reflected in each subarea with values than are scaled according to a function (square root) of the unit's area. Intuitively, it makes sense that the bigger the subarea, the longer the flow routing lag. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">ref_area</span> <span class="o">=</span> <span class="mi">250</span> <span class="c1"># The area for which the scaling of x4 is invariant</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">time_span</span> <span class="o">=</span> <span class="mi">86400</span> <span class="c1"># The time step of the simulation, one day is 86400 seconds</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="c1"># time_span = 3600 # if we had an hourly simulation, and hourly inputs </span>
</code></pre></div>
<p>While it is possible to construct meta-parameterisers from scratch, it is tedious. The GR4J/H scaling strategy is well known and pre-implemented in <code>gr4j_scaled_parameteriser</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">gr4j_scaled_parameteriser</span><span class="p">(</span><span class="n">ref_area</span><span class="p">,</span> <span class="n">time_span</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>  Name  Value   Min     Max
0   x2    1.0 -27.0    27.0
1   x3   10.0   0.0  1000.0
2   x4   14.0   1.0   240.0
3   x1   44.6   1.0  1000.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># set x4 bounds to be in &quot;days&quot;, not hours</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">p_x4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;x4&quot;</span><span class="p">],</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>    <span class="s2">&quot;Min&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">],</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="s2">&quot;Max&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">],</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="p">})</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">p</span><span class="o">.</span><span class="n">set_hypercube</span><span class="p">(</span><span class="n">p_x4</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">p</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>  Name  Value    Min     Max
0   x2    1.0 -27.00    27.0
1   x3   10.0   0.00  1000.0
2   x4    1.0   0.25    10.0
3   x1   44.6   1.00  1000.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">subarea_ids</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="s2">&quot;subarea&quot;</span><span class="p">,</span> <span class="n">get_subarea_ids</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">areas</span> <span class="o">=</span> <span class="n">get_state_value</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">paste</span><span class="p">(</span><span class="n">subarea_ids</span><span class="p">,</span> <span class="s2">&quot;areaKm2&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="n">areas</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.areaKm2&#39;: 109.06779661017,
 &#39;subarea.lnk2.areaKm2&#39;: 113.861985472155,
 &#39;subarea.lnk3.areaKm2&#39;: 7.1912832929779995,
 &#39;subarea.lnk4.areaKm2&#39;: 153.41404358353498,
 &#39;subarea.lnk5.areaKm2&#39;: 111.464891041162}
</code></pre></div>
<p>Let us have a look at the values of the <code>x4</code> parameters in each subarea, before and after applying this meta-parameteriser <code>p</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">x4_param_ids</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="n">subarea_ids</span><span class="p">,</span> <span class="s2">&quot;x4&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">get_state_value</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">x4_param_ids</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.x4&#39;: 0.5,
 &#39;subarea.lnk2.x4&#39;: 0.5,
 &#39;subarea.lnk3.x4&#39;: 0.5,
 &#39;subarea.lnk4.x4&#39;: 0.5,
 &#39;subarea.lnk5.x4&#39;: 0.5}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">p</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">get_state_value</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">x4_param_ids</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.lnk1.x4&#39;: 0.6605082788585469,
 &#39;subarea.lnk2.x4&#39;: 0.6748688330991586,
 &#39;subarea.lnk3.x4&#39;: 0.16960286899670063,
 &#39;subarea.lnk4.x4&#39;: 0.7833620965646346,
 &#39;subarea.lnk5.x4&#39;: 0.6677271629675162}
</code></pre></div>
<p>The values of the individual x4 parameters are scaled according to the area of subareas. The larger the catchment, the larger the routing delay, the larger <code>x4</code>. The reference area for which the scaling would be 1.0 is 250 km^2, so the closer the catchment area from 250 km^2, the closer to 1.0 the area based scaling.</p>
<p>We can compose a parameter transformation, on top of the tied. It is typical to calibrate on log(x4) rather than x4</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wrap_transform</span><span class="p">()</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">p</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span><span class="s2">&quot;log_x4&quot;</span><span class="p">,</span> <span class="s2">&quot;x4&quot;</span><span class="p">,</span> <span class="s2">&quot;log10&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">p</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>     Name  Value       Min     Max
0  log_x4    0.0  -0.60206     1.0
1      x2    1.0 -27.00000    27.0
2      x3   10.0   0.00000  1000.0
3      x1   44.6   1.00000  1000.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">outflowVarname</span> <span class="o">=</span> <span class="s2">&quot;Catchment.StreamflowRate&quot;</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">record_state</span><span class="p">(</span><span class="n">outflowVarname</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">calc</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">outflowVarname</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">flow</span> <span class="o">=</span> <span class="n">as_xarray_series</span><span class="p">(</span><span class="n">daily_cumecs</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">vis_e</span> <span class="o">=</span> <span class="n">as_timestamp</span><span class="p">(</span><span class="n">xr_ts_end</span><span class="p">(</span><span class="n">flow</span><span class="p">))</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">vis_s</span> <span class="o">=</span> <span class="n">vis_e</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">plot_two_series</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">calc</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Observed&quot;</span><span class="p">,</span> <span class="s2">&quot;Calculated&quot;</span><span class="p">],</span> <span class="n">start_time</span><span class="o">=</span><span class="n">vis_s</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">vis_e</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_61_0.png" /></p>
<h2 id="optimiser">Optimiser<a class="headerlink" href="#optimiser" title="Permanent link">&para;</a></h2>
<p>Let'c create an NSE evaluator, and check what the default parameter set yields as a goodness of fit.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">objective</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">create_objective</span><span class="p">(</span><span class="n">outflowVarname</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="s2">&quot;NSE&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE&#39;: -5.5724317674396335}, &#39;sysconfig&#39;:      Name  Value       Min     Max
0  log_x4    0.0  -0.60206     1.0
1      x2    1.0 -27.00000    27.0
2      x3   10.0   0.00000  1000.0
3      x1   44.6   1.00000  1000.0}
</code></pre></div>
<p>We have our objectives defined, and the parameter space 'p' in which to search. Let's create an optimiser and we are ready to go. While the optimiser can be created in one line, we show how to choose one custom termination criterion and how to configure the optimiser to capture a detailed log of the process.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">if</span> <span class="s2">&quot;SWIFT_FULL&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>    <span class="n">max_hours</span> <span class="o">=</span> <span class="mf">0.2</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>    <span class="n">max_hours</span> <span class="o">=</span> <span class="mf">0.02</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="n">term</span> <span class="o">=</span> <span class="n">get_marginal_termination</span><span class="p">(</span><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1e-05</span><span class="p">,</span> <span class="n">cutoff_no_improvement</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">max_hours</span> <span class="o">=</span> <span class="n">max_hours</span><span class="p">)</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="c1"># term = get_max_runtime_termination(max_hours=max_hours)</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">get_default_sce_parameters</span><span class="p">()</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="n">urs</span> <span class="o">=</span> <span class="n">create_parameter_sampler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s2">&quot;urs&quot;</span><span class="p">)</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">sce_params</span><span class="p">,</span> <span class="n">urs</span><span class="p">)</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="n">calib_logger</span> <span class="o">=</span> <span class="n">set_calibration_logger</span><span class="p">(</span><span class="n">optimiser</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>At this point you may want to specify the maximum number of cores that can be used by the optimiser, for instance if you wish to keep one core free to work in parallel on something else.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">sce_params</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;P&#39;: 6,
 &#39;Pmin&#39;: 6,
 &#39;M&#39;: 9,
 &#39;Q&#39;: 7,
 &#39;Alpha&#39;: 1,
 &#39;Beta&#39;: 9,
 &#39;NumShuffle&#39;: 40,
 &#39;TrapezoidalDensityParameter&#39;: 1.0,
 &#39;ReflectionRatio&#39;: -1.0,
 &#39;ContractionRatio&#39;: 0.5}
</code></pre></div>
<p>The number of complexes is 6; by default the optimiser will try to use 6 CPU cores in parallel, or n-1 where N is your number of cores and less than 6. It is possible to limit the level of parallelism if needed, for instance to make sure you have a few cores to work with if an optimiser will run for some time.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">optimiser</span><span class="o">.</span><span class="n">set_maximum_threads_free_cores</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">execute_optimisation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CPU times: user 1min 24s, sys: 97 ms, total: 1min 24s
Wall time: 16.7 s
</code></pre></div>
<p>Processing the calibration log below. We subset the full log to keep only some types of optimiser messages, in this case we do not keep the "shuffling" stages of the SCE algorithm.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">opt_log</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">extract_optimisation_log</span><span class="p">(</span><span class="n">fitness_name</span><span class="o">=</span><span class="s2">&quot;NSE&quot;</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">geom_ops</span> <span class="o">=</span> <span class="n">opt_log</span><span class="o">.</span><span class="n">subset_by_message</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;Initial.*|Reflec.*|Contrac.*|Add.*&quot;</span><span class="p">)</span>
</code></pre></div>
<p>We can then visualize how the calibration evolved. There are several types of visualisations included in the <strong>mhplot</strong> package, and numerous customizations possible, but starting with the overall population evolution:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">geom_ops</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>count    4330.000000
mean        0.243069
std        17.977975
min      -911.455996
25%         0.832460
50%         0.834778
75%         0.834778
max         0.834778
Name: NSE, dtype: float64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">p_var_ids</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">p_var_ids</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>array([&#39;log_x4&#39;, &#39;x2&#39;, &#39;x3&#39;, &#39;x1&#39;], dtype=object)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">v</span> <span class="o">=</span> <span class="n">OptimisationPlots</span><span class="p">(</span><span class="n">geom_ops</span><span class="p">)</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="k">for</span> <span class="n">pVarId</span> <span class="ow">in</span> <span class="n">p_var_ids</span><span class="p">:</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>    <span class="n">v</span><span class="o">.</span><span class="n">parameter_evolution</span><span class="p">(</span><span class="n">pVarId</span><span class="p">,</span> <span class="n">obj_lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_76_0.png" /></p>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_76_1.png" /></p>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_76_2.png" /></p>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_76_3.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># sortedResults = sortByScore(calib_results, &#39;NSE&#39;)</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="c1"># best_pset = getScoreAtIndex(sortedResults, 1)</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="c1"># best_pset = GetSystemConfigurationWila_R(best_pset)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">best_pset</span> <span class="o">=</span> <span class="n">calib_results</span><span class="o">.</span><span class="n">get_best_score</span><span class="p">(</span><span class="s2">&quot;NSE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parameteriser</span>
</code></pre></div>
<p><em>swift</em> can back-transform a parameters to obtain the untransformed parameter set(s):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">best_pset</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>     Name       Value       Min     Max
0  log_x4    0.191326  -0.60206     1.0
1      x2    2.389509 -27.00000    27.0
2      x3   93.649566   0.00000  1000.0
3      x1  633.394693   1.00000  1000.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">untfPset</span> <span class="o">=</span> <span class="n">best_pset</span><span class="o">.</span><span class="n">backtransform</span><span class="p">()</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">best_pset</span><span class="p">)</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE&#39;: 0.8347778235911274},
 &#39;sysconfig&#39;:      Name       Value       Min     Max
 0  log_x4    0.191326  -0.60206     1.0
 1      x2    2.389509 -27.00000    27.0
 2      x3   93.649566   0.00000  1000.0
 3      x1  633.394693   1.00000  1000.0}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">untfPset</span><span class="p">)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE&#39;: 0.8347778235911274},
 &#39;sysconfig&#39;:   Name       Value    Min     Max
 0   x2    2.389509 -27.00    27.0
 1   x3   93.649566   0.00  1000.0
 2   x4    1.553554   0.25    10.0
 3   x1  633.394693   1.00  1000.0}
</code></pre></div>
<p>Finally, let's have a visual of the fitted streamflow data at Bright:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">best_pset</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="n">mod_runoff</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">outflowVarname</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">plot_two_series</span><span class="p">(</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>    <span class="n">flow</span><span class="p">,</span> <span class="n">mod_runoff</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">vis_s</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">vis_e</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;observed&quot;</span><span class="p">,</span> <span class="s2">&quot;modelled&quot;</span><span class="p">]</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../meta_parameters_files/meta_parameters_85_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># runoff = flow / sum(areasKm2)</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="c1"># runoff.plot()</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="c1"># plot_two_series(</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="c1">#     rainfall, runoff, start_time=vis_s, end_time=vis_e, names=[&quot;observed rain&quot;, &quot;observed runoff&quot;]</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="c1"># )</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 CSIRO
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>