
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bindings to access the SWIFT2 libraries, from Python.">
      
      
        <meta name="author" content="Jean-Michel Perraud">
      
      
        <link rel="canonical" href="https://csiro-hydroinformatics.github.io/swift-py-doc/notebooks/getting_started/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Getting started with the swift python package - swift2 - Python package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started-with-the-swift-python-package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="swift2 - Python package" class="md-header__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            swift2 - Python package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting started with the swift python package
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../classes/" class="md-tabs__link">
          
  
  
    
  
  Submodules

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tech_notes/" class="md-tabs__link">
          
  
  
    
  
  Appendix

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="swift2 - Python package" class="md-nav__button md-logo" aria-label="swift2 - Python package" data-md-component="logo">
      
  <img src="../../images/ensembles.png" alt="logo">

    </a>
    swift2 - Python package
  </label>
  
    <div class="md-nav__source">
      <a href="https://bitbucket.csiro.au/projects/SF/repos/swift" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    bitbucket/SWIFT2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Submodules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Submodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../const/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    const
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doc_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    doc_helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    internal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameteriser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    parameteriser
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../play_record/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    play_record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prototypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    prototypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statistics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    system
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with the swift python package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meta_parameters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrating tied meta parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble_model_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble SWIFT model runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_initial_states/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration with initial model memory states as parameters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_multisite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration of a catchment using multisite multiobjective composition
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reservoir_geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reservoir geometry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibrate_subcatchments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascaded calibration of subcatchments defined by multiple gauges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../log_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample code for log-likelihood calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../muskingum_multilink_calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linear Muskingum channel routing model - constrained subcatchment calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error_correction_four_stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error correction models - ERRIS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tech_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tech Notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-this-document" class="md-nav__link">
    <span class="md-ellipsis">
      About this document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lumped-catchment-data-daily-data" class="md-nav__link">
    <span class="md-ellipsis">
      Lumped catchment data, daily data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lumped catchment data, daily data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-series-data-representation" class="md-nav__link">
    <span class="md-ellipsis">
      Time series data representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Model execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Model outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-model-states" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising model states
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-the-model-interactively" class="md-nav__link">
    <span class="md-ellipsis">
      Exploring the model interactively
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploring the model interactively">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assessing-a-change-in-the-input-series" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing a change in the input series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assessing-the-impact-of-a-change-in-one-model-parameter" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing the impact of a change in one model parameter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-the-calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Defining the calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Defining the calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    <span class="md-ellipsis">
      Objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feasible-parameter-space" class="md-nav__link">
    <span class="md-ellipsis">
      Feasible parameter space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimiser" class="md-nav__link">
    <span class="md-ellipsis">
      Optimiser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assessing-the-optimisation" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing the optimisation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assessing the optimisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visualising-the-optimisation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising the optimisation process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-series-visualisation" class="md-nav__link">
    <span class="md-ellipsis">
      Time series visualisation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="getting-started-with-the-swift-python-package">Getting started with the swift python package<a class="headerlink" href="#getting-started-with-the-swift-python-package" title="Permanent link">&para;</a></h1>
<h2 id="about-this-document">About this document<a class="headerlink" href="#about-this-document" title="Permanent link">&para;</a></h2>
<p>This is a minimal but realistic simulation workflow for swift. It was ported from an original <a href="https://github.com/csiro-hydroinformatics/streamflow-forecasting-tools-onboard/blob/master/doc/vignettes/getting_started/getting_started.md">vignette</a> in the R package <code>swift</code>. The python package <a href="https://csiro-hydroinformatics.github.io/swift-py-doc/"><code>swift2</code></a> is, as of August 2023, at least at feature parity with the long established R package. </p>
<p>This is the introduction 'notebook' to a python package for interacting with SWIFT. It shows one of the most basic usage, running a single model simulation. While basic, it is realistic and uses data from a study catchment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">pkg_versions_info</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">pkg_versions_info</span><span class="p">(</span><span class="s2">&quot;This document was generated from a jupyter notebook&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>This document was generated from a jupyter notebook on 2025-03-27 17:24:44.897481
    swift2 2.5.1
    uchronia 2.6.2
</code></pre></div>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>This notebook requires a working Python environment, e.g. a conda environment. See the <a href="https://csiro-hydroinformatics.github.io/streamflow-forecasting-tools-onboard/">Streamflow Forecasting</a> landing page for information about installing the software.</p>
<h2 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</code></pre></div>
<p>Finally we import some visualisation facilities</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
</code></pre></div>
<p>Some dependencies of <strong>swift2</strong>, namely <strong>cinterop</strong>, offer generic functions for time series manipulations. While these could be imported via <strong>swift2</strong> as well, let's be explicit for now:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">cinterop.timeseries</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">TIME_DIMNAME</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">as_timestamp</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">pd_series_to_xr_series</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="n">slice_xr_time_series</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">xr_ts_end</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">xr_ts_start</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.doc_helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_free_params</span><span class="p">,</span> <span class="n">sample_series</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.parameteriser</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">create_parameter_sampler</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">create_parameteriser</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="n">create_sce_termination_wila</span><span class="p">,</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="n">get_default_sce_parameters</span><span class="p">,</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="p">)</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.simulation</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_subarea_simulation</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.system</span><span class="w"> </span><span class="kn">import</span> <span class="n">runoff_model_ids</span><span class="p">,</span> <span class="n">runoff_model_var_ids</span>
</code></pre></div>
<p>We import the main functions upfront from the package submodules. In practice this is something you may need to do only on an as needed basis of course. Jupyter notebooks can show dynanically submodules and functions listed, along with some documentation. A searchable technical documentation for the package is available from <a href="https://csiro-hydroinformatics.github.io/swift-py-doc">Python swift2 documentation</a>. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">mk_full_data_id</span><span class="p">,</span> <span class="n">paste_2</span><span class="p">,</span> <span class="n">vpaste</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<h2 id="lumped-catchment-data-daily-data">Lumped catchment data, daily data<a class="headerlink" href="#lumped-catchment-data-daily-data" title="Permanent link">&para;</a></h2>
<p>The package contains some sample data for a few Australian catchments. Note that these sample data are for documentation only and not to be used for real world applications.  </p>
<p><strong>swift</strong> now has some functions to create a single subarea simulation for testing purposes, including the function <code>create_subarea_simulation</code>. While is it perfectly possible to manually build your own model simulation from scratch, for the sake of getting started quickly let's use pre-defined functions to get a model simulation ready to run. The parameters of the function should be fairly self-explanatory. But in general you can see function documentation with commands appended with the <code>?</code> string, e.g. <code>create_subarea_simulation?</code>. You can also browse the <a href="https://csiro-hydroinformatics.github.io/swift-py-doc">Python swift2 documentation</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">create_subarea_simulation</span><span class="err">?</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">ms</span> <span class="o">=</span> <span class="n">create_subarea_simulation</span><span class="p">(</span><span class="n">data_id</span><span class="o">=</span><span class="s1">&#39;MMH&#39;</span><span class="p">,</span> <span class="n">simul_start</span><span class="o">=</span><span class="s1">&#39;1990-01-01&#39;</span><span class="p">,</span> <span class="n">simul_end</span><span class="o">=</span><span class="s1">&#39;2005-12-31&#39;</span><span class="p">,</span> 
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">model_id</span><span class="o">=</span><span class="s1">&#39;GR4J&#39;</span><span class="p">,</span> <span class="n">tstep</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">varname_rain</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">varname_pet</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">ms</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Simulation wrapper for a CFFI pointer handle to a native pointer of type id &quot;MODEL_SIMULATION_PTR&quot;
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">type</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>swift2.classes.Simulation
</code></pre></div>
<p>The python object <code>ms</code> may appear unusual to most users. This is basically a handle to the SWIFT simulation object written in C++. The model core is native, but wrapped by a "pythonic" <code>Simulation</code> object. The low-level interaction between python and the C API is handled by "glue code" and users will rarely if ever need to use the low-level API.</p>
<p>The <code>Simulation</code> object has python methods to interact with it, for instance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">describe</span><span class="err">?</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subareas&#39;: {&#39;Subarea&#39;: &#39;Subarea&#39;}, &#39;nodes&#39;: {}, &#39;links&#39;: {}}
</code></pre></div>
<p>Because we got a preconfigured, sample simulation, it is ready to execute, which means it already has some input data defined (a site with a codename 'MMH'). The <code>SWIFT</code> system uses the terms <code>playing from</code> and <code>recording to</code> time series, using an old style audio tape system as a metaphor. We can inspect the simulation for instance using <code>get_played_varnames</code> to check which state variable has an input time series:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_played_varnames</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;subarea.Subarea.E&#39;, &#39;subarea.Subarea.P&#39;]
</code></pre></div>
<h3 id="time-series-data-representation">Time series data representation<a class="headerlink" href="#time-series-data-representation" title="Permanent link">&para;</a></h3>
<p>Let us have a look at these input time series to the simulation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">tts</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_played</span><span class="p">()</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">tts</span>
</code></pre></div>
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (variable_identifiers: 2, ensemble: 1, time: 5844)&gt; Size: 94kB
array([[[5.5422, 5.5522, 5.5622, ..., 6.0744, 6.0735, 6.0725]],

       [[0.    , 0.    , 0.    , ..., 2.1569, 0.    , 0.    ]]],
      shape=(2, 1, 5844))
Coordinates:
  * ensemble              (ensemble) int64 8B 0
  * time                  (time) datetime64[ns] 47kB 1990-01-01 ... 2005-12-31
  * variable_identifiers  (variable_identifiers) object 16B &#x27;subarea.Subarea....</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>variable_identifiers</span>: 2</li><li><span class='xr-has-index'>ensemble</span>: 1</li><li><span class='xr-has-index'>time</span>: 5844</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-8577b12b-0837-452b-8164-0d70583dfa08' class='xr-array-in' type='checkbox' checked><label for='section-8577b12b-0837-452b-8164-0d70583dfa08' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>5.542 5.552 5.562 5.572 5.582 5.592 ... 0.0659 0.5425 2.157 0.0 0.0</span></div><div class='xr-array-data'><pre>array([[[5.5422, 5.5522, 5.5622, ..., 6.0744, 6.0735, 6.0725]],

       [[0.    , 0.    , 0.    , ..., 2.1569, 0.    , 0.    ]]],
      shape=(2, 1, 5844))</pre></div></div></li><li class='xr-section-item'><input id='section-b951aa71-628a-4c6e-9e0c-d855c90f017b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b951aa71-628a-4c6e-9e0c-d855c90f017b' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>ensemble</span></div><div class='xr-var-dims'>(ensemble)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-4cefde9b-d9e6-47b6-92ac-c321b176bc01' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4cefde9b-d9e6-47b6-92ac-c321b176bc01' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-80b6d073-2af0-4dcb-bf4f-84f55c23e2f2' class='xr-var-data-in' type='checkbox'><label for='data-80b6d073-2af0-4dcb-bf4f-84f55c23e2f2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1990-01-01 ... 2005-12-31</div><input id='attrs-9aa27ee1-f1a4-4e01-90aa-d88c64bf3811' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9aa27ee1-f1a4-4e01-90aa-d88c64bf3811' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5241dccf-95ce-40fa-b4ea-2df8e70874a3' class='xr-var-data-in' type='checkbox'><label for='data-5241dccf-95ce-40fa-b4ea-2df8e70874a3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;1990-01-01T00:00:00.000000000&#x27;, &#x27;1990-01-02T00:00:00.000000000&#x27;,
       &#x27;1990-01-03T00:00:00.000000000&#x27;, ..., &#x27;2005-12-29T00:00:00.000000000&#x27;,
       &#x27;2005-12-30T00:00:00.000000000&#x27;, &#x27;2005-12-31T00:00:00.000000000&#x27;],
      shape=(5844,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>variable_identifiers</span></div><div class='xr-var-dims'>(variable_identifiers)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;subarea.Subarea.E&#x27; &#x27;subarea.Sub...</div><input id='attrs-ae043567-e5e0-41c6-bf19-621c3281ce70' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ae043567-e5e0-41c6-bf19-621c3281ce70' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a1133007-170a-4467-8d71-f3440de99d27' class='xr-var-data-in' type='checkbox'><label for='data-a1133007-170a-4467-8d71-f3440de99d27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;subarea.Subarea.E&#x27;, &#x27;subarea.Subarea.P&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7ca4fd2b-21d8-4870-90f3-99afb6021867' class='xr-section-summary-in' type='checkbox'  ><label for='section-7ca4fd2b-21d8-4870-90f3-99afb6021867' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>ensemble</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-edb17b03-7dec-4cd1-bbad-9b0cb8c928f1' class='xr-index-data-in' type='checkbox'/><label for='index-edb17b03-7dec-4cd1-bbad-9b0cb8c928f1' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0], dtype=&#x27;int64&#x27;, name=&#x27;ensemble&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e72dcfb7-3eb3-4b8d-9c72-58e51f912ec0' class='xr-index-data-in' type='checkbox'/><label for='index-e72dcfb7-3eb3-4b8d-9c72-58e51f912ec0' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;1990-01-01&#x27;, &#x27;1990-01-02&#x27;, &#x27;1990-01-03&#x27;, &#x27;1990-01-04&#x27;,
               &#x27;1990-01-05&#x27;, &#x27;1990-01-06&#x27;, &#x27;1990-01-07&#x27;, &#x27;1990-01-08&#x27;,
               &#x27;1990-01-09&#x27;, &#x27;1990-01-10&#x27;,
               ...
               &#x27;2005-12-22&#x27;, &#x27;2005-12-23&#x27;, &#x27;2005-12-24&#x27;, &#x27;2005-12-25&#x27;,
               &#x27;2005-12-26&#x27;, &#x27;2005-12-27&#x27;, &#x27;2005-12-28&#x27;, &#x27;2005-12-29&#x27;,
               &#x27;2005-12-30&#x27;, &#x27;2005-12-31&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=5844, freq=&#x27;D&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>variable_identifiers</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-e93171ef-5012-4b6f-b238-c99beaf3bac1' class='xr-index-data-in' type='checkbox'/><label for='index-e93171ef-5012-4b6f-b238-c99beaf3bac1' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;subarea.Subarea.E&#x27;, &#x27;subarea.Subarea.P&#x27;], dtype=&#x27;object&#x27;, name=&#x27;variable_identifiers&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f322f832-13f8-45eb-841e-968d6aad638f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f322f832-13f8-45eb-841e-968d6aad638f' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>

<p>The C++ core has its own internal representation of time series. The Python package <code>swift2</code> uses generally <a href="https://docs.xarray.dev/en/stable/"><code>xarray</code></a> to represent time series, as it is particularly suited to handle ensemble of time series of dimensionality more than 2. The ensemble dimension is thus present by default in the returned array, even when there is only one realisation. This can be removed with the <a href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.squeeze.html#xarray.DataArray.squeeze"><code>squeeze</code></a> method of xarray. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">tts</span> <span class="o">=</span> <span class="n">tts</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">g</span> <span class="o">=</span> <span class="n">tts</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable_identifiers&quot;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">g</span><span class="p">;</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_25_0.png" /></p>
<p>Many <code>swift2</code> python functions will however also accept <a href="https://pandas.pydata.org/docs/">pandas</a> <code>DataFrame</code> or <code>Series</code> as input for time series when it makes sense to accept such time series representations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">play_input</span><span class="err">?</span>
</code></pre></div>
<p>We can check with the <code>get_recorded_varnames</code> method that simulation object as not been "told" to record an output time series yet. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_recorded_varnames</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[]
</code></pre></div>
<p>SWIFT is designed to record model variables on demand in a highly flexible manner. First, we can query the system to find out known rainfall-runoff models, and the model variable names that we can record.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">runoff_model_ids</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;NetRainfall&#39;,
 &#39;GR2M_MOD&#39;,
 &#39;GR4J&#39;,
 &#39;GR4J_SG&#39;,
 &#39;GR5H&#39;,
 &#39;GR6J&#39;,
 &#39;GR5J&#39;,
 &#39;PDM&#39;,
 &#39;AWBM&#39;,
 &#39;SACSMA&#39;,
 &#39;SACSMA_NSW&#39;,
 &#39;constant_outflow&#39;,
 &#39;external&#39;,
 &#39;WAPABA&#39;,
 &#39;GRKAL&#39;,
 &#39;SimHyd&#39;,
 &#39;HBV&#39;]
</code></pre></div>
<p>The GR4J model has the following states that can be "listened to" and "recorded" on demand over a simulation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">gr4j_model_vars</span> <span class="o">=</span> <span class="n">runoff_model_var_ids</span><span class="p">(</span><span class="s1">&#39;GR4J&#39;</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">gr4j_model_vars</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;P&#39;, &#39;E&#39;, &#39;En&#39;, &#39;LAI&#39;, &#39;runoff&#39;, &#39;S&#39;, &#39;R&#39;, &#39;TWS&#39;, &#39;Eactual&#39;, &#39;Ps&#39;, &#39;Es&#39;, &#39;Pr&#39;, &#39;ech1&#39;, &#39;ech2&#39;, &#39;Perc&#39;, &#39;alpha&#39;, &#39;k&#39;, &#39;x1&#39;, &#39;x2&#39;, &#39;x3&#39;, &#39;x4&#39;, &#39;UHExponent&#39;, &#39;PercFactor&#39;]
</code></pre></div>
<p>These are the variable names for a single GR4J model instance; since SWIFT is for semi-distributed models, we need to use a hierarchical naming scheme to uniquely identify model variables (even when in this case we do have only one subarea). Using unique keys allow to inspect the model states in great details if needed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_subarea_ids</span><span class="p">()</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="s1">&#39;subarea.Subarea.x4&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.Subarea.x4&#39;: 0.5}
</code></pre></div>
<p>Let's record to time series all the storage and flux states of GR4J (no need to record model parameters which will be flat lines here). We can use the utility function <a href="https://csiro-hydroinformatics.github.io/swift-py-doc/code-reference/?h=mk_full_data_id#swift2.utils.mk_full_data_id"><code>mk_full_data_id</code></a> for conciseness to vectorise the handling of multiple state identifiers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">to_record</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;runoff&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;Ps&#39;</span><span class="p">,</span> <span class="s1">&#39;Es&#39;</span><span class="p">,</span> <span class="s1">&#39;Pr&#39;</span><span class="p">,</span> <span class="s1">&#39;ech1&#39;</span><span class="p">,</span> <span class="s1">&#39;ech2&#39;</span><span class="p">,</span> <span class="s1">&#39;Perc&#39;</span><span class="p">]</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">ids</span> <span class="o">=</span> <span class="n">mk_full_data_id</span><span class="p">(</span><span class="s1">&#39;subarea&#39;</span><span class="p">,</span> <span class="s1">&#39;Subarea&#39;</span><span class="p">,</span> <span class="n">to_record</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">record_state</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">get_recorded_varnames</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[&#39;subarea.Subarea.Es&#39;,
 &#39;subarea.Subarea.Perc&#39;,
 &#39;subarea.Subarea.Pr&#39;,
 &#39;subarea.Subarea.Ps&#39;,
 &#39;subarea.Subarea.R&#39;,
 &#39;subarea.Subarea.S&#39;,
 &#39;subarea.Subarea.ech1&#39;,
 &#39;subarea.Subarea.ech2&#39;,
 &#39;subarea.Subarea.runoff&#39;]
</code></pre></div>
<h3 id="model-execution">Model execution<a class="headerlink" href="#model-execution" title="Permanent link">&para;</a></h3>
<p><code>ms</code> was configured to record model outputs, now we can execute the simulation, with its parameters set to whatever defaults it has. Note that <code>ms</code> also has a <code>check_simulation</code> method that can provide information about  obvious configuration issues when execution fails. Typically inconstent start and end dates between simulation and input time series. In this case, nothing is reported in this simple and preconfigured case.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">check_simulation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;errors&#39;: []}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">ms</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
</code></pre></div>
<h3 id="model-outputs">Model outputs<a class="headerlink" href="#model-outputs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">var_series</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">()</span>
</code></pre></div>
<p>We have a 3 dimensional data array, with 9 identifiers for state variables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">var_series</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">var_series</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>((&#39;variable_identifiers&#39;, &#39;ensemble&#39;, &#39;time&#39;), (9, 1, 5844))
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">var_coords</span> <span class="o">=</span> <span class="n">var_series</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;variable_identifiers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">var_coords</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>array([&#39;subarea.Subarea.Es&#39;, &#39;subarea.Subarea.Perc&#39;, &#39;subarea.Subarea.Pr&#39;,
       &#39;subarea.Subarea.Ps&#39;, &#39;subarea.Subarea.R&#39;, &#39;subarea.Subarea.S&#39;,
       &#39;subarea.Subarea.ech1&#39;, &#39;subarea.Subarea.ech2&#39;,
       &#39;subarea.Subarea.runoff&#39;], dtype=object)
</code></pre></div>
<p>The variable identifiers are fully qualified, which is fine and certainly make a lot of sense for semi-distributed catchments. But to visualise these for a single subarea we shall override with short model names:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">var_series</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;variable_identifiers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;subarea.Subarea.&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">var_coords</span><span class="p">])</span>
</code></pre></div>
<h3 id="visualising-model-states">Visualising model states<a class="headerlink" href="#visualising-model-states" title="Permanent link">&para;</a></h3>
<p>Let's look at a shorter period of the output. We define a couple of functions to slice and plot the last three years of the time series, for clarity.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">last_three_years</span><span class="p">(</span><span class="n">tts</span><span class="p">:</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>    <span class="n">start</span><span class="o">=</span><span class="n">tts</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">TIME_DIMNAME</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="n">end</span><span class="o">=</span><span class="n">tts</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">TIME_DIMNAME</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="k">return</span> <span class="n">slice_xr_time_series</span><span class="p">(</span><span class="n">tts</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">plot_obs_vs_calc</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">calc</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;runoff (mm)&quot;</span><span class="p">):</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">uchronia.utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">uu</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    <span class="n">obs</span> <span class="o">=</span> <span class="n">last_three_years</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="n">calc</span> <span class="o">=</span> <span class="n">last_three_years</span><span class="p">(</span><span class="n">calc</span><span class="p">)</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">both</span> <span class="o">=</span> <span class="n">uu</span><span class="o">.</span><span class="n">xr_concat</span><span class="p">([</span><span class="n">obs</span><span class="p">,</span><span class="n">calc</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span><span class="s1">&#39;calculated&#39;</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">)</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="n">both</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">s</span> <span class="o">=</span> <span class="n">last_three_years</span><span class="p">(</span><span class="n">var_series</span><span class="p">)</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># , main = &#39;Default GR4J output on MMH data&#39;)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;variable_identifiers&quot;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_54_0.png" /></p>
<h2 id="exploring-the-model-interactively">Exploring the model interactively<a class="headerlink" href="#exploring-the-model-interactively" title="Permanent link">&para;</a></h2>
<h3 id="assessing-a-change-in-the-input-series">Assessing a change in the input series<a class="headerlink" href="#assessing-a-change-in-the-input-series" title="Permanent link">&para;</a></h3>
<p>As mentioned earlier, it is change to define the model simulation definition directly and interactively. The following shows how a to assign another input time series. We use a somewhat contrived example of a scaled up precipitation input series, to see what is the effect on the runoff.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">precip_id</span> <span class="o">=</span> <span class="s1">&#39;subarea.Subarea.P&#39;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">runoff_id</span> <span class="o">=</span> <span class="s1">&#39;subarea.Subarea.runoff&#39;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">precip</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_played</span><span class="p">(</span><span class="n">precip_id</span><span class="p">)</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">baseline_runoff</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">)</span>
</code></pre></div>
<p>Because we are about to work on a scenario, rather than modifying <code>ms</code> we are going to keep it as a clean baseline, and create a full "clone" of the catchment model. This is an understated feature of <code>swift2</code>, but a cornerstone of proper scenario comparison (and help limit modelling mistakes)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">ms_wetter</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">precip_scaled</span> <span class="o">=</span> <span class="n">precip</span> <span class="o">*</span> <span class="mf">1.1</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">precip_scaled</span> <span class="o">=</span> <span class="n">precip_scaled</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">ms_wetter</span><span class="o">.</span><span class="n">play_input</span><span class="p">(</span><span class="n">precip_scaled</span><span class="p">,</span> <span class="n">precip_id</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">ms_wetter</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">runoff_diff</span> <span class="o">=</span> <span class="n">ms_wetter</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">)</span> <span class="o">-</span> <span class="n">baseline_runoff</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">runoff_diff</span> <span class="o">=</span> <span class="n">runoff_diff</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The additional runoff depth we get with a rainfall scaled up by 10 percent is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">runoff_diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Change in runoff with precipitations scaled up by 10%&#39;</span><span class="p">)</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;runoff depth change (mm/day)&#39;</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_62_0.png" /></p>
<h3 id="assessing-the-impact-of-a-change-in-one-model-parameter">Assessing the impact of a change in one model parameter<a class="headerlink" href="#assessing-the-impact-of-a-change-in-one-model-parameter" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">x4_id</span> <span class="o">=</span> <span class="s1">&#39;subarea.Subarea.x4&#39;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">x4</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_state_value</span><span class="p">(</span><span class="n">x4_id</span><span class="p">)</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">x4</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;subarea.Subarea.x4&#39;: 0.5}
</code></pre></div>
<p>The returned value for <span class="arithmatex">\(x_4\)</span> is in a dictionary, because <code>get_state_value</code> is vectorised and can retrieve several state values at the same time. <code>set_state_value</code> on the other hand accepts multiple types of inputs including scalars for convenience:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">x4_inital</span> <span class="o">=</span> <span class="n">x4</span><span class="p">[</span><span class="n">x4_id</span><span class="p">]</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1"># Again, keep the baseline clean and work on a copy</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">ms_x4</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="n">ms_x4</span><span class="o">.</span><span class="n">set_state_value</span><span class="p">(</span><span class="n">x4_id</span><span class="p">,</span> <span class="n">x4_inital</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="n">ms_x4</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="n">runoff_diff</span> <span class="o">=</span> <span class="n">ms_x4</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">)</span> <span class="o">-</span> <span class="n">baseline_runoff</span>
</code></pre></div>
<p>One effect of <span class="arithmatex">\(x_4\)</span> is on the lagging effect, so the difference in runoff should be overall near zero, but with local variations:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">runoff_diff</span> <span class="o">=</span> <span class="n">runoff_diff</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">blah</span> <span class="o">=</span> <span class="n">last_three_years</span><span class="p">(</span><span class="n">runoff_diff</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Change in runoff with x4 scaled up by 10%&#39;</span><span class="p">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;runoff depth change (mm/day)&#39;</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_68_0.png" /></p>
<h2 id="calibration">Calibration<a class="headerlink" href="#calibration" title="Permanent link">&para;</a></h2>
<p>Let's now set up a calibration against the observed runoff depth for this data 'MMH', included as sample data in the package, and view it along the current default model runoff output.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">obs_runoff</span> <span class="o">=</span> <span class="n">sample_series</span><span class="p">(</span><span class="s1">&#39;MMH&#39;</span><span class="p">,</span> <span class="s1">&#39;flow&#39;</span><span class="p">)</span> <span class="c1">#actually, runoff depth</span>
</code></pre></div>
<p>Negative data in the observed streamflow is a code for missing data. It is better to use <code>np.nan</code> in Python for this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">obs_runoff</span><span class="p">[</span><span class="n">obs_runoff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">obs_runoff</span> <span class="o">=</span> <span class="n">pd_series_to_xr_series</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">)</span>
</code></pre></div>
<p>Let's view the default modelled output from <strong>GR4J</strong>, overlayed with the observation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">plot_obs_vs_calc</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">,</span> <span class="n">baseline_runoff</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">));</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_74_0.png" /></p>
<h3 id="defining-the-calibration">Defining the calibration<a class="headerlink" href="#defining-the-calibration" title="Permanent link">&para;</a></h3>
<p>Before we go ahead in setting up this calibration, it is worth outlining key aspects of software architecture in <code>swift2</code> and its <a href="https://github.com/csiro-hydroinformatics/wila">metaheuristics optimisation library, "wila"</a> upfront.</p>
<p>At a high level a calibration process conceptually needs:</p>
<ul>
<li>the specification of a feasible parameter space <span class="arithmatex">\(X = x_1, x_2, ..., x_n\)</span>, typically with feasible intervals for each <span class="arithmatex">\(x_i\)</span></li>
<li>an objective evaluation <span class="arithmatex">\(Obj(X)\)</span></li>
<li>and an optimisation algorithm that uses <span class="arithmatex">\(Obj\)</span> and evaluates it on parameter values <span class="arithmatex">\(X_p\)</span> sampled from <span class="arithmatex">\(X\)</span></li>
</ul>
<p>Formulating a calibration in <code>swift2</code> follows this pattern. There is usually no need to explicitely handle the hydrological model, which is hidden behind <span class="arithmatex">\(Obj\)</span>, and for some reasons this can be an unfamiliar viewpoint for many hydrologist.</p>
<p>Readers interesting in modelling and optimisation framework design and implementation can read <a href="https://dl.acm.org/doi/abs/10.5555/1718024">Talbi, El-Ghazali. Metaheuristics: from design to implementation. John Wiley &amp; Sons, 2009.</a> for a comprehensive overview.</p>
<p>Now let us see what these are in practice. </p>
<p><strong>Note</strong>: There are several time stamp representations in the Python ecosystem. A dependency package of the <code>swift2</code> package , <strong>cinterop</strong>, has a <a href="https://cinterop.readthedocs.io/en/latest/timeseries-module/">time series module</a> with date-time and time series related utilities, such as <code>xr_ts_start</code>, <code>as_timestamp</code> to reduce the tedium of date-time handling. You may also already be using third-party utilities as well. </p>
<h4 id="objective">Objective<a class="headerlink" href="#objective" title="Permanent link">&para;</a></h4>
<p>Part of the information for the objective is over which time span we calculate the goodness of fit, usually different from the simulation length to leave period for a model warmup</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">s</span> <span class="o">=</span> <span class="n">xr_ts_start</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="c1"># Warmup:</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">w</span> <span class="o">=</span> <span class="n">as_timestamp</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">e</span> <span class="o">=</span> <span class="n">xr_ts_end</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">)</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="n">ms</span><span class="o">.</span><span class="n">set_simulation_span</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>
<p>We now have all the information needed to create a calibration objective using for instance the Nash-Sutcliffe Efficiency </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">objective</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">create_objective</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">,</span> <span class="n">obs_runoff</span><span class="p">,</span> <span class="s1">&#39;NSE&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>
<p>The variable <code>objective</code> now references an objective evaluator.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nb">type</span><span class="p">(</span><span class="n">objective</span><span class="p">),</span> <span class="n">objective</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(swift2.classes.ObjectiveEvaluator,
 CFFI pointer handle to a native pointer of type id &quot;OBJECTIVE_EVALUATOR_WILA_PTR&quot;)
</code></pre></div>
<p>An objective evaluator evaluates one or more goodness of fit (a.k.a. "scores") via the method <code>objective.get_score</code>. We need to provide a set of model parameters to evaluate the resulting scores. The utility function <code>get_free_params</code> provides a template for some models including <strong>GR4J</strong>, in the form of a pandas DataFrame</p>
<h4 id="feasible-parameter-space">Feasible parameter space<a class="headerlink" href="#feasible-parameter-space" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">pspec_gr4j</span> <span class="o">=</span> <span class="n">get_free_params</span><span class="p">(</span><span class="s1">&#39;GR4J&#39;</span><span class="p">)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="n">pspec_gr4j</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>x1</td>
      <td>650.488000</td>
      <td>1.0</td>
      <td>3000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>x2</td>
      <td>-0.280648</td>
      <td>-27.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>x3</td>
      <td>7.891230</td>
      <td>1.0</td>
      <td>660.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>x4</td>
      <td>18.917200</td>
      <td>1.0</td>
      <td>240.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can set some values and min/max bounds in this data frame. The min/max bounds are important for the upcoming calibration process.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">542.1981111</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.4127542</span><span class="p">,</span>   <span class="mf">7.7403390</span> <span class="p">,</span>  <span class="mf">1.2388548</span><span class="p">]</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Min</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Max</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">pspec_gr4j</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>x1</td>
      <td>542.198111</td>
      <td>1</td>
      <td>1000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>x2</td>
      <td>-0.412754</td>
      <td>-30</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>x3</td>
      <td>7.740339</td>
      <td>1</td>
      <td>1000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>x4</td>
      <td>1.238855</td>
      <td>1</td>
      <td>240.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Our model states have the prefix 'subarea.Subarea.', so we need to use this prefix in our data frame of parameters as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">vpaste</span><span class="p">(</span><span class="s1">&#39;subarea.Subarea.&#39;</span><span class="p">,</span> <span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
</code></pre></div>
<p>We can now create a parameteriser. It can be converted back to a data frame to check its content.</p>
<p><strong>Note</strong>: we will be using the untransformed parameters for calibration for the sake of simplicity in this introductory material. In practice we should use some transformations to facilitate the calibration, and there are many features in <strong>swift2</strong> to do so.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">create_parameteriser</span><span class="p">(</span><span class="s1">&#39;Generic&#39;</span><span class="p">,</span> <span class="n">pspec_gr4j</span><span class="p">)</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">p</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Value</th>
      <th>Min</th>
      <th>Max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>subarea.Subarea.x1</td>
      <td>542.198111</td>
      <td>1.0</td>
      <td>1000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>subarea.Subarea.x2</td>
      <td>-0.412754</td>
      <td>-30.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>subarea.Subarea.x3</td>
      <td>7.740339</td>
      <td>1.0</td>
      <td>1000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>subarea.Subarea.x4</td>
      <td>1.238855</td>
      <td>1.0</td>
      <td>240.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now let us check that we can indeed evaluate the goodness of fit for this parameteriser <code>p</code> using the <code>objective</code>: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">score</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">get_score</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;scores&#39;: {&#39;NSE&#39;: -2.3381787784819057},
 &#39;sysconfig&#39;:                  Name       Value   Min     Max
 0  subarea.Subarea.x1  542.198111   1.0  1000.0
 1  subarea.Subarea.x2   -0.412754 -30.0    30.0
 2  subarea.Subarea.x3    7.740339   1.0  1000.0
 3  subarea.Subarea.x4    1.238855   1.0   240.0}
</code></pre></div>
<p>Our calibration objective calculator is structurally valid.</p>
<h4 id="optimiser">Optimiser<a class="headerlink" href="#optimiser" title="Permanent link">&para;</a></h4>
<p>To create an optimiser, we need to specify a termination criterion. There are several options available to control when an optimisation process will finish in a calibration. One of them uses the standard deviation of parameter values for population based algorithms such as the shuffled complex evolution algorithm (SCE). We can specify that the optimisation has converged once the standard deviation of each parameter (x1, x2, etc. for GR4J) is within </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">term</span> <span class="o">=</span> <span class="n">create_sce_termination_wila</span><span class="p">(</span><span class="s1">&#39;relative standard deviation&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0.002&#39;</span><span class="p">,</span><span class="s1">&#39;0.0167&#39;</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">sce_params</span> <span class="o">=</span> <span class="n">get_default_sce_parameters</span><span class="p">()</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="n">urs</span> <span class="o">=</span> <span class="n">create_parameter_sampler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;urs&#39;</span><span class="p">)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">sce_params</span><span class="p">,</span> <span class="n">urs</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">optimiser</span><span class="o">.</span><span class="n">set_calibration_logger</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="o">%%</span><span class="n">time</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">execute_optimisation</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CPU times: user 21.7 s, sys: 42.8 ms, total: 21.7 s
Wall time: 4.31 s
</code></pre></div>
<p><strong>swift</strong> uses optimization tools that will parallelize model simulation runs if possible (i.e. if supported by the model). This may not be noticeable in this instance, but is important to scale up to larger catchment models. </p>
<h2 id="assessing-the-optimisation">Assessing the optimisation<a class="headerlink" href="#assessing-the-optimisation" title="Permanent link">&para;</a></h2>
<p>There are facilities in the package to extract, exploit and visualise the optimisation log information.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">opt_log</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">extract_optimisation_log</span><span class="p">(</span><span class="n">fitness_name</span> <span class="o">=</span> <span class="s2">&quot;NSE&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">opt_log</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Category</th>
      <th>CurrentShuffle</th>
      <th>Message</th>
      <th>NSE</th>
      <th>subarea.Subarea.x1</th>
      <th>subarea.Subarea.x2</th>
      <th>subarea.Subarea.x3</th>
      <th>subarea.Subarea.x4</th>
      <th>PointNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>-1339.285380</td>
      <td>947.690750</td>
      <td>23.005202</td>
      <td>62.217181</td>
      <td>161.886443</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>-0.890844</td>
      <td>174.551633</td>
      <td>-7.280393</td>
      <td>710.469274</td>
      <td>96.390541</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>-0.327150</td>
      <td>214.709001</td>
      <td>-7.069954</td>
      <td>124.638641</td>
      <td>18.990489</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>-2.367463</td>
      <td>724.720289</td>
      <td>6.659042</td>
      <td>930.609993</td>
      <td>207.726829</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Initial Population</td>
      <td></td>
      <td>Initial Population</td>
      <td>-913.046415</td>
      <td>874.130073</td>
      <td>28.643820</td>
      <td>126.360349</td>
      <td>83.693269</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">opt_log</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Category</th>
      <th>CurrentShuffle</th>
      <th>Message</th>
      <th>NSE</th>
      <th>subarea.Subarea.x1</th>
      <th>subarea.Subarea.x2</th>
      <th>subarea.Subarea.x3</th>
      <th>subarea.Subarea.x4</th>
      <th>PointNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13967</th>
      <td>Shuffling No 28</td>
      <td></td>
      <td>Shuffling No 28</td>
      <td>0.768667</td>
      <td>999.096491</td>
      <td>-5.620413</td>
      <td>91.829530</td>
      <td>1.000574</td>
      <td>13968</td>
    </tr>
    <tr>
      <th>13968</th>
      <td>Shuffling No 28</td>
      <td></td>
      <td>Shuffling No 28</td>
      <td>0.768742</td>
      <td>996.688456</td>
      <td>-5.679336</td>
      <td>93.670035</td>
      <td>1.000339</td>
      <td>13969</td>
    </tr>
    <tr>
      <th>13969</th>
      <td>Shuffling No 28</td>
      <td></td>
      <td>Shuffling No 28</td>
      <td>0.768590</td>
      <td>995.813747</td>
      <td>-5.731252</td>
      <td>95.427583</td>
      <td>1.000443</td>
      <td>13970</td>
    </tr>
    <tr>
      <th>13970</th>
      <td>Shuffling No 28</td>
      <td></td>
      <td>Shuffling No 28</td>
      <td>0.768553</td>
      <td>994.549300</td>
      <td>-5.677011</td>
      <td>96.570436</td>
      <td>1.000202</td>
      <td>13971</td>
    </tr>
    <tr>
      <th>13971</th>
      <td>Shuffling No 28</td>
      <td></td>
      <td>Best point in shuffle</td>
      <td>0.768844</td>
      <td>997.616573</td>
      <td>-5.649821</td>
      <td>92.890522</td>
      <td>1.000003</td>
      <td>13972</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's subset the data points to keep a subset, the points from the initial population and SCE geometric transformations (reflection, contraction, addition). We can use a regular expression pattern to do so. <code>MhData</code> is a glorified data frame, but its methods are handy to reduce tedium.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">geom_ops</span> <span class="o">=</span> <span class="n">opt_log</span><span class="o">.</span><span class="n">subset_by_message</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span> <span class="s1">&#39;Initial.*|Reflec.*|Contrac.*|Add.*&#39;</span><span class="p">)</span> <span class="c1"># same as default argument, but to be explicit</span>
</code></pre></div>
<p>Let us also rename the column names without the fully qualified prefix</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">p_var_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x3&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">]</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">remap</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;subarea.Subarea.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">p_var_ids</span><span class="p">}</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="n">geom_ops</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span><span class="n">remap</span><span class="p">)</span>
</code></pre></div>
<h3 id="visualising-the-optimisation-process">Visualising the optimisation process<a class="headerlink" href="#visualising-the-optimisation-process" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.vis</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimisationPlots</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="n">v</span> <span class="o">=</span> <span class="n">OptimisationPlots</span><span class="p">(</span><span class="n">geom_ops</span><span class="p">)</span>
</code></pre></div>
<p>We can see that at least one of the parameters, namely "x1", settled at its upper boundary of 1000:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">g</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">parameter_evolution</span><span class="p">(</span><span class="n">p_var_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj_lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_108_0.png" /></p>
<p>Note that the parameter x4 also seems to have settled at its lower bound:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">v</span><span class="o">.</span><span class="n">parameter_evolution</span><span class="p">(</span><span class="n">p_var_ids</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">obj_lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_110_0.png" /></p>
<p>x4 influences the unit hydrograph, and the meaning of this parameter depends on the time step of the input series. It may be justified in this case to go below 1 for its lower bound. Also, the default maximum value 240 is typically sensible for use with hourly data, not daily, so we may want to reduce this maximum. </p>
<p>So let's restart the calibration, with a larger upper bound for the x1 parameter, and adjusted x4 bounds as well:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="n">pspec_gr4j</span><span class="o">.</span><span class="n">Min</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">create_parameteriser</span><span class="p">(</span><span class="s1">&#39;Generic&#39;</span><span class="p">,</span> <span class="n">pspec_gr4j</span><span class="p">)</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">urs</span> <span class="o">=</span> <span class="n">create_parameter_sampler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;urs&#39;</span><span class="p">)</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="n">optimiser</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">create_sce_optim_swift</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">sce_params</span><span class="p">,</span> <span class="n">urs</span><span class="p">)</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">calib_logger</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">set_calibration_logger</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="n">calib_results</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">execute_optimisation</span><span class="p">()</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="n">opt_log</span> <span class="o">=</span> <span class="n">optimiser</span><span class="o">.</span><span class="n">extract_optimisation_log</span><span class="p">(</span><span class="n">fitness_name</span> <span class="o">=</span> <span class="s2">&quot;NSE&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="n">geom_ops</span> <span class="o">=</span> <span class="n">opt_log</span><span class="o">.</span><span class="n">subset_by_message</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span> <span class="s1">&#39;Initial.*|Reflec.*|Contrac.*|Add.*&#39;</span><span class="p">)</span> <span class="c1"># same as default argument, but to be explicit</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">p_var_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x3&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">]</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="n">remap</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;subarea.Subarea.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">p_var_ids</span><span class="p">}</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="n">geom_ops</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span><span class="n">remap</span><span class="p">)</span>
</code></pre></div>
<p>Let's check that the parameter does not settle at the boundary anymore:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">v</span> <span class="o">=</span> <span class="n">OptimisationPlots</span><span class="p">(</span><span class="n">geom_ops</span><span class="p">)</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">g</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">parameter_evolution</span><span class="p">(</span><span class="n">p_var_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj_lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_118_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">v</span><span class="o">.</span><span class="n">parameter_evolution</span><span class="p">(</span><span class="n">p_var_ids</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">obj_lims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_119_0.png" /></p>
<p><em>Note</em>: There are a few additional visualisation options in the R package <a href="https://github.com/csiro-hydroinformatics/mhplot"><strong>mhplot</strong></a> that may be ported to python as needed.</p>
<p>We can inspect further the behavior of the SCE optimiser by using facetted plots with the package <strong>seaborn</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">geom_ops</span><span class="o">.</span><span class="n">data</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">grid</span> <span class="o">=</span> <span class="n">geom_ops</span><span class="o">.</span><span class="n">facet_plot</span><span class="p">(</span><span class="n">p_var_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_122_0.png" /></p>
<p>Let's retrieve the parameter set with the best NSE, and see the resulting runoff time series. <code>calib_results</code> is a native C++ object, but its wrapper has functions to query it and extract the information wanted.</p>
<p><code>calib_results</code> is the final population of parameter sets. To get the best score within it (i.e. the best fitness and associated parameters), we can use: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">best_pset</span> <span class="o">=</span> <span class="n">calib_results</span><span class="o">.</span><span class="n">get_best_score</span><span class="p">(</span><span class="s1">&#39;NSE&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">best_pset</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>CFFI pointer handle to a native pointer of type id &quot;OBJECTIVE_SCORES_WILA_PTR&quot;

Scores:

{&#39;NSE&#39;: 0.7832225081975563}

Parameters:

                 Name        Value   Min     Max
0  subarea.Subarea.x1  1141.419555   1.0  2500.0
1  subarea.Subarea.x2    -5.448833 -30.0    30.0
2  subarea.Subarea.x3    97.579250   1.0  1000.0
3  subarea.Subarea.x4     0.414422   0.2    10.0
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="n">opt_log</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Category</th>
      <th>CurrentShuffle</th>
      <th>Message</th>
      <th>NSE</th>
      <th>subarea.Subarea.x1</th>
      <th>subarea.Subarea.x2</th>
      <th>subarea.Subarea.x3</th>
      <th>subarea.Subarea.x4</th>
      <th>PointNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8697</th>
      <td>Shuffling No 17</td>
      <td></td>
      <td>Shuffling No 17</td>
      <td>0.783221</td>
      <td>1136.271566</td>
      <td>-5.462186</td>
      <td>97.798741</td>
      <td>0.425679</td>
      <td>8698</td>
    </tr>
    <tr>
      <th>8698</th>
      <td>Shuffling No 17</td>
      <td></td>
      <td>Shuffling No 17</td>
      <td>0.783220</td>
      <td>1140.838174</td>
      <td>-5.423250</td>
      <td>97.721428</td>
      <td>0.397216</td>
      <td>8699</td>
    </tr>
    <tr>
      <th>8699</th>
      <td>Shuffling No 17</td>
      <td></td>
      <td>Shuffling No 17</td>
      <td>0.783218</td>
      <td>1138.591759</td>
      <td>-5.473618</td>
      <td>98.148408</td>
      <td>0.418075</td>
      <td>8700</td>
    </tr>
    <tr>
      <th>8700</th>
      <td>Shuffling No 17</td>
      <td></td>
      <td>Shuffling No 17</td>
      <td>0.783215</td>
      <td>1151.965067</td>
      <td>-5.400726</td>
      <td>96.862435</td>
      <td>0.463490</td>
      <td>8701</td>
    </tr>
    <tr>
      <th>8701</th>
      <td>Shuffling No 17</td>
      <td></td>
      <td>Best point in shuffle</td>
      <td>0.783223</td>
      <td>1141.419555</td>
      <td>-5.448833</td>
      <td>97.579250</td>
      <td>0.414422</td>
      <td>8702</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="time-series-visualisation">Time series visualisation<a class="headerlink" href="#time-series-visualisation" title="Permanent link">&para;</a></h2>
<p>Let's apply this parameter to the original simulation, and execute it to get output runoff.</p>
<p>Note, as an aside, that below for didactic purposes we see only the last 3 years of time series, while the NSE score is calculated over several more years. As it happens, the runoff prediction has a systematic negative bias over these three particular years.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">best_pset</span><span class="o">.</span><span class="n">apply_sys_config</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">ms</span><span class="o">.</span><span class="n">exec_simulation</span><span class="p">()</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="n">plot_obs_vs_calc</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_129_0.png" /></p>
<p>Looking at the whole series over the simulation, indeed these last three years appear untypical in terms of match between observed and calculated</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">swift2.vis</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_two_series</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">plot_two_series</span><span class="p">(</span><span class="n">obs_runoff</span><span class="p">,</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_recorded</span><span class="p">(</span><span class="n">runoff_id</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span><span class="s1">&#39;calculated&#39;</span><span class="p">])</span>
</code></pre></div>
<p><img alt="png" src="../getting_started_files/getting_started_132_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2022 CSIRO
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>